<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APF Resource Person Dashboard</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect width='64' height='64' rx='14' fill='%236366f1'/%3E%3Cpath d='M32 48c0 0 0-12 0-18s-6-12-14-14c2 6 4 12 14 16M32 48c0 0 0-12 0-18s6-12 14-14c-2 6-4 12-14 16' fill='none' stroke='white' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'/%3E%3Ccircle cx='32' cy='14' r='3' fill='%2334d399'/%3E%3C/svg%3E">
    <meta name="description"
        content="Productivity dashboard for Resource Persons at Azim Premji Foundation â€” manage school visits, teacher training, observations, reports, and resources.">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta name="referrer" content="no-referrer">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://unpkg.com/peerjs@1.5.4/dist/peerjs.min.js"></script>
</head>

<body>
    <!-- License Key Gate -->
    <div id="licenseScreen" class="lock-screen" style="display:none;">
        <div class="lock-container license-container">
            <div class="lock-icon" style="background:linear-gradient(135deg,#6366f1,#8b5cf6);box-shadow:0 8px 24px rgba(99,102,241,0.3);">
                <i class="fas fa-key"></i>
            </div>
            <h1 class="lock-title">License Required</h1>
            <p class="lock-subtitle">Enter your license key to activate the dashboard.<br>Contact the developer if you don't have one.</p>
            <form id="licenseForm" onsubmit="handleLicenseSubmit(event)" autocomplete="off">
                <div class="lock-input-group">
                    <div class="lock-input-wrapper">
                        <i class="fas fa-key"></i>
                        <input type="password" id="licenseKeyInput" placeholder="License Key" autofocus required>
                        <button type="button" class="lock-eye-btn" onclick="togglePasswordVisibility('licenseKeyInput', this)" tabindex="-1">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                <div class="lock-error" id="licenseError"></div>
                <button type="submit" class="btn btn-primary lock-btn" style="background:linear-gradient(135deg,#6366f1,#8b5cf6);">
                    <i class="fas fa-unlock"></i> Activate
                </button>
            </form>
            <div class="lock-footer" style="margin-top:24px;">
                <p style="font-size:11px;color:var(--text-muted);opacity:0.7;"><i class="fas fa-shield-alt"></i> Protected software â€” unauthorized use is prohibited</p>
            </div>
        </div>
    </div>

    <!-- User Guide Modal -->
    <div class="modal-overlay" id="userGuideModal">
        <div class="guide-modal">
            <div class="guide-header">
                <div class="guide-header-left">
                    <div class="guide-logo"><i class="fas fa-seedling"></i></div>
                    <div>
                        <h2>APF Dashboard â€” User Guide</h2>
                        <p>Everything you need to know to get started</p>
                    </div>
                </div>
                <button class="modal-close" onclick="closeUserGuide()"><i class="fas fa-times"></i></button>
            </div>
            <div class="guide-body" id="guideBody">
                <!-- Steps rendered by JS -->
            </div>
            <div class="guide-footer">
                <button class="btn btn-ghost" id="guidePrevBtn" onclick="guideNav(-1)"><i class="fas fa-arrow-left"></i> Previous</button>
                <div class="guide-dots" id="guideDots"></div>
                <button class="btn btn-primary" id="guideNextBtn" onclick="guideNav(1)">Next <i class="fas fa-arrow-right"></i></button>
            </div>
        </div>
    </div>

    <!-- Password Lock Screen -->
    <div id="lockScreen" class="lock-screen" style="display:none;">
        <div class="lock-container">
            <div class="lock-icon" id="lockIconTap" title="APF Dashboard"><i class="fas fa-shield-alt"></i></div>
            <h1 class="lock-title">APF Dashboard</h1>
            <p class="lock-subtitle" id="lockSubtitle">Enter your password to continue</p>
            <form id="lockForm" onsubmit="handlePasswordSubmit(event)" autocomplete="off">
                <div class="lock-input-group">
                    <div class="lock-input-wrapper">
                        <i class="fas fa-lock"></i>
                        <input type="password" id="lockPassword" placeholder="Password" autofocus required minlength="4">
                        <button type="button" class="lock-eye-btn" onclick="togglePasswordVisibility('lockPassword', this)" tabindex="-1">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                <!-- Confirm field shown only during setup -->
                <div class="lock-input-group" id="lockConfirmGroup" style="display:none;">
                    <div class="lock-input-wrapper">
                        <i class="fas fa-lock"></i>
                        <input type="password" id="lockPasswordConfirm" placeholder="Confirm password" minlength="4">
                        <button type="button" class="lock-eye-btn" onclick="togglePasswordVisibility('lockPasswordConfirm', this)" tabindex="-1">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                <div class="lock-error" id="lockError"></div>
                <button type="submit" class="btn btn-primary lock-btn" id="lockSubmitBtn">
                    <i class="fas fa-unlock"></i> Unlock
                </button>
            </form>
            <div class="lock-footer" id="lockFooter">
                <div id="lockEmergencyReset" style="display:none;">
                    <p style="color:#ef4444;font-size:12px;margin-bottom:10px;"><i class="fas fa-exclamation-triangle"></i> Emergency reset will <strong>permanently delete ALL data</strong></p>
                    <button type="button" class="btn btn-danger" onclick="resetPasswordPrompt()" style="font-size:12px;padding:8px 16px;width:100%;">
                        <i class="fas fa-trash-alt"></i> Emergency Data Reset
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Welcome / Data Load Screen -->
    <div id="welcomeScreen" class="welcome-screen" style="display:none;">
        <div class="welcome-container">
            <div class="welcome-icon"><i class="fas fa-shield-alt"></i></div>
            <h1 class="welcome-title">APF Dashboard</h1>
            <p class="welcome-subtitle">Welcome! Load your existing data file or start fresh. After this, your data auto-saves securely â€” no need to load the file again.</p>
            <div class="welcome-actions">
                <label class="btn btn-primary welcome-btn welcome-load-btn">
                    <i class="fas fa-folder-open"></i> Load Existing Data File (.apf)
                    <input type="file" accept=".apf" onchange="welcomeLoadFile(event)" style="display:none">
                </label>
                <div class="welcome-divider"><span>or start new</span></div>
                <button class="btn btn-outline welcome-btn" onclick="welcomeStartFresh(false)">
                    <i class="fas fa-plus-circle"></i> Start Fresh (Empty)
                </button>
                <button class="btn btn-outline welcome-btn welcome-sample-btn" onclick="welcomeStartFresh(true)">
                    <i class="fas fa-database"></i> Start with Sample Data
                </button>
            </div>
            <div class="welcome-status" id="welcomeStatus" style="display:none;"></div>
            <div class="welcome-note">
                <i class="fas fa-info-circle"></i>
                <span>Your data is encrypted (AES-256) and auto-saved. Next time, just enter your password.</span>
            </div>
        </div>
    </div>

    <!-- Sidebar Navigation -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <div class="logo-icon"><i class="fas fa-seedling"></i></div>
                <div class="logo-text">
                    <span class="logo-title">APF Dashboard</span>
                    <span class="logo-subtitle">Resource Person</span>
                </div>
            </div>
            <button class="sidebar-toggle-btn" id="sidebarToggle" title="Collapse sidebar" onclick="toggleDesktopSidebar()">
                <i class="fas fa-chevron-left"></i>
            </button>
        </div>
        <nav class="sidebar-nav">
            <a href="#" class="nav-item active" data-section="dashboard" id="nav-dashboard" data-tooltip="Dashboard">
                <i class="fas fa-th-large"></i><span>Dashboard</span>
            </a>
            <a href="#" class="nav-item" data-section="visits" id="nav-visits" data-tooltip="School Visits">
                <i class="fas fa-school"></i><span>School Visits</span>
            </a>
            <a href="#" class="nav-item" data-section="training" id="nav-training" data-tooltip="Teacher Training">
                <i class="fas fa-chalkboard-teacher"></i><span>Teacher Training</span>
            </a>
            <a href="#" class="nav-item" data-section="observations" id="nav-observations" data-tooltip="Observations">
                <i class="fas fa-clipboard-check"></i><span>Observations</span>
            </a>
            <a href="#" class="nav-item" data-section="reports" id="nav-reports" data-tooltip="Reports">
                <i class="fas fa-chart-bar"></i><span>Reports</span>
            </a>
            <a href="#" class="nav-item" data-section="resources" id="nav-resources" data-tooltip="Resource Library">
                <i class="fas fa-book-open"></i><span>Resource Library</span>
            </a>
            <div class="nav-divider"></div>
            <a href="#" class="nav-item" data-section="excel" id="nav-excel" data-tooltip="Excel Analytics">
                <i class="fas fa-file-excel"></i><span>Excel Analytics</span>
            </a>
            <a href="#" class="nav-item" data-section="notes" id="nav-notes" data-tooltip="Quick Notes">
                <i class="fas fa-sticky-note"></i><span>Quick Notes</span>
            </a>
            <a href="#" class="nav-item" data-section="planner" id="nav-planner" data-tooltip="Weekly Planner">
                <i class="fas fa-calendar-week"></i><span>Weekly Planner</span>
            </a>
            <a href="#" class="nav-item" data-section="goals" id="nav-goals" data-tooltip="Goal Tracker">
                <i class="fas fa-bullseye"></i><span>Goal Tracker</span>
            </a>
            <a href="#" class="nav-item" data-section="analytics" id="nav-analytics" data-tooltip="Analytics">
                <i class="fas fa-chart-pie"></i><span>Analytics</span>
            </a>
            <a href="#" class="nav-item" data-section="followups" id="nav-followups" data-tooltip="Follow-ups">
                <i class="fas fa-tasks"></i><span>Follow-ups</span>
            </a>
            <a href="#" class="nav-item" data-section="ideas" id="nav-ideas" data-tooltip="Idea Tracker">
                <i class="fas fa-lightbulb"></i><span>Idea Tracker</span>
            </a>
            <div class="nav-divider"></div>
            <a href="#" class="nav-item" data-section="schools" id="nav-schools" data-tooltip="School Profiles">
                <i class="fas fa-map-marker-alt"></i><span>School Profiles</span>
            </a>
            <a href="#" class="nav-item" data-section="teachers" id="nav-teachers" data-tooltip="Teacher Growth">
                <i class="fas fa-user-graduate"></i><span>Teacher Growth</span>
            </a>
            <a href="#" class="nav-item" data-section="marai" id="nav-marai" data-tooltip="MARAI Tracking">
                <i class="fas fa-route"></i><span>MARAI Tracking</span>
            </a>
            <a href="#" class="nav-item" data-section="schoolwork" id="nav-schoolwork" data-tooltip="School Work">
                <i class="fas fa-chalkboard"></i><span>School Work</span>
            </a>
            <a href="#" class="nav-item" data-section="visitplan" id="nav-visitplan" data-tooltip="Visit Plan">
                <i class="fas fa-clipboard-check"></i><span>Visit Plan</span>
            </a>
            <a href="#" class="nav-item" data-section="reflections" id="nav-reflections" data-tooltip="Reflections">
                <i class="fas fa-journal-whills"></i><span>Reflections</span>
            </a>
            <a href="#" class="nav-item" data-section="growth" id="nav-growth" data-tooltip="Growth Framework">
                <i class="fas fa-seedling"></i><span>Growth Framework</span>
            </a>
            <a href="#" class="nav-item" data-section="contacts" id="nav-contacts" data-tooltip="Contacts">
                <i class="fas fa-address-book"></i><span>Contacts</span>
            </a>
            <a href="#" class="nav-item" data-section="meetings" id="nav-meetings" data-tooltip="Meetings">
                <i class="fas fa-handshake"></i><span>Meetings</span>
            </a>
            <a href="#" class="nav-item" data-section="livesync" id="nav-livesync" data-tooltip="Live Sync">
                <i class="fas fa-sync-alt"></i><span>Live Sync</span>
                <span class="sync-status-dot" id="syncNavDot" title="Offline"></span>
            </a>
            <a href="#" class="nav-item" data-section="worklog" id="nav-worklog" data-tooltip="Work Log">
                <i class="fas fa-clipboard-list"></i><span>Work Log</span>
            </a>
            <a href="#" class="nav-item" data-section="backup" id="nav-backup" data-tooltip="Data & Security">
                <i class="fas fa-shield-alt"></i><span>Data & Security</span>
            </a>
            <a href="#" class="nav-item" data-section="settings" id="nav-settings" data-tooltip="Settings">
                <i class="fas fa-cog"></i><span>Settings</span>
            </a>
            <a href="#" class="nav-item" data-section="feedback" id="nav-feedback" data-tooltip="Feedback">
                <i class="fas fa-bug"></i><span>Bug & Feedback</span>
            </a>
        </nav>
        <div class="sidebar-footer">
            <div class="user-info" onclick="openProfileModal()" style="cursor:pointer;" title="Click to edit your profile">
                <div class="user-avatar" id="userAvatarIcon"><i class="fas fa-user"></i></div>
                <div class="user-details">
                    <span class="user-name" id="userName">Resource Person</span>
                    <span class="user-role" id="userOrg">Azim Premji Foundation</span>
                </div>
                <button class="theme-toggle-btn" id="themeToggle" onclick="event.stopPropagation(); toggleTheme()" title="Switch theme">
                    <i class="fas fa-moon" id="themeIcon"></i>
                </button>
            </div>
        </div>
    </aside>

    <!-- Mobile Header -->
    <header class="mobile-header" id="mobileHeader">
        <button class="menu-toggle" id="menuToggle"><i class="fas fa-bars"></i></button>
        <span class="mobile-title">APF Dashboard</span>
    </header>

    <!-- Overlay for mobile sidebar -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Main Content -->
    <main class="main-content" id="mainContent">

        <!-- ==================== DASHBOARD SECTION ==================== -->
        <section class="content-section active" id="section-dashboard">
            <div class="section-header">
                <div>
                    <h1 id="dashboardGreeting">Welcome back! ðŸ‘‹</h1>
                    <p class="section-subtitle" id="dashboardDate"></p>
                </div>
                <div class="header-actions">
                    <button class="btn btn-outline" onclick="exportAllDataToExcel()">
                        <i class="fas fa-download"></i> Export Data
                    </button>
                    <button class="btn btn-primary" onclick="openQuickAdd()">
                        <i class="fas fa-plus"></i> Quick Add
                    </button>
                </div>
            </div>

            <!-- Smart Alerts -->
            <div class="dashboard-alerts" id="dashboardAlerts"></div>

            <!-- Metric Cards -->
            <div class="metrics-grid">
                <div class="metric-card metric-visits">
                    <div class="metric-icon"><i class="fas fa-school"></i></div>
                    <div class="metric-info">
                        <span class="metric-value" id="metricTotalVisits">0</span>
                        <span class="metric-label">Total Visits</span>
                    </div>
                    <div class="metric-trend up"><i class="fas fa-arrow-up"></i> This month</div>
                </div>
                <div class="metric-card metric-trainings">
                    <div class="metric-icon"><i class="fas fa-chalkboard-teacher"></i></div>
                    <div class="metric-info">
                        <span class="metric-value" id="metricTrainings">0</span>
                        <span class="metric-label">Trainings Held</span>
                    </div>
                    <div class="metric-trend up"><i class="fas fa-arrow-up"></i> This month</div>
                </div>
                <div class="metric-card metric-observations">
                    <div class="metric-icon"><i class="fas fa-eye"></i></div>
                    <div class="metric-info">
                        <span class="metric-value" id="metricObservations">0</span>
                        <span class="metric-label">Observations</span>
                    </div>
                    <div class="metric-trend neutral"><i class="fas fa-minus"></i> This month</div>
                </div>
                <div class="metric-card metric-schools">
                    <div class="metric-icon"><i class="fas fa-map-marker-alt"></i></div>
                    <div class="metric-info">
                        <span class="metric-value" id="metricSchools">0</span>
                        <span class="metric-label">Schools Covered</span>
                    </div>
                    <div class="metric-trend up"><i class="fas fa-arrow-up"></i> Total</div>
                </div>
            </div>

            <!-- Dashboard Grid -->
            <div class="dashboard-grid">
                <div class="card upcoming-card">
                    <div class="card-header">
                        <h3><i class="fas fa-calendar-alt"></i> Upcoming Visits</h3>
                        <a href="#" class="card-link" onclick="navigateTo('visits')">View All</a>
                    </div>
                    <div class="card-body" id="upcomingVisitsList">
                        <div class="empty-state small">
                            <i class="fas fa-calendar-plus"></i>
                            <p>No upcoming visits scheduled</p>
                        </div>
                    </div>
                </div>
                <div class="card activity-card">
                    <div class="card-header">
                        <h3><i class="fas fa-clock"></i> Recent Activity</h3>
                    </div>
                    <div class="card-body" id="recentActivityList">
                        <div class="empty-state small">
                            <i class="fas fa-history"></i>
                            <p>No recent activity</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dashboard Charts Row -->
            <div class="dashboard-charts-row">
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-chart-line"></i> Monthly Activity</h3>
                        <a href="#" class="card-link" onclick="navigateTo('analytics')">Full Analytics</a>
                    </div>
                    <div class="card-body">
                        <canvas id="dashboardMonthlyChart" style="max-height:250px;"></canvas>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-chart-doughnut"></i> Visit Status</h3>
                    </div>
                    <div class="card-body">
                        <canvas id="dashboardStatusChart" style="max-height:250px;"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- ==================== SCHOOL VISITS SECTION ==================== -->
        <section class="content-section" id="section-visits">
            <div class="section-header">
                <div>
                    <h1><i class="fas fa-school"></i> School Visits</h1>
                    <p class="section-subtitle">Plan, track, and document your school visits</p>
                </div>
                <div class="header-actions">
                    <button class="btn btn-primary" onclick="openVisitModal()">
                        <i class="fas fa-plus"></i> New Visit
                    </button>
                </div>
            </div>

            <!-- Visit Stats Dashboard -->
            <div id="visitStatsDash" class="visit-stats-dash"></div>

            <!-- Filters -->
            <div class="filter-bar">
                <div class="filter-group">
                    <select id="visitStatusFilter" onchange="_pageState.visits=1;renderVisits()">
                        <option value="all">All Status</option>
                        <option value="planned">Planned</option>
                        <option value="completed">Completed</option>
                        <option value="cancelled">Cancelled</option>
                    </select>
                    <select id="visitPurposeFilter" onchange="_pageState.visits=1;renderVisits()">
                        <option value="all">All Purposes</option>
                        <option value="Classroom Observation">Classroom Observation</option>
                        <option value="Teacher Support">Teacher Support</option>
                        <option value="Workshop Facilitation">Workshop</option>
                        <option value="Meeting with HM">Meeting with HM</option>
                        <option value="Follow-up">Follow-up</option>
                        <option value="Material Distribution">Material Distribution</option>
                        <option value="Other">Other</option>
                    </select>
                    <select id="visitBlockFilter" onchange="_pageState.visits=1;renderVisits()">
                        <option value="all">All Blocks</option>
                    </select>
                    <input type="text" id="visitSearchInput" placeholder="Search schools, clusters..." oninput="_pageState.visits=1;renderVisits()">
                </div>
                <div class="view-toggles">
                    <button class="view-btn active" data-view="list" onclick="setVisitView('list')"><i
                            class="fas fa-list"></i></button>
                    <button class="view-btn" data-view="calendar" onclick="setVisitView('calendar')"><i
                            class="fas fa-calendar"></i></button>
                </div>
            </div>

            <!-- Calendar View -->
            <div id="visitCalendarView" class="visit-calendar-view" style="display:none"></div>

            <!-- Visits List -->
            <div id="visitsContainer" class="visits-list">
                <div class="empty-state">
                    <i class="fas fa-school"></i>
                    <h3>No school visits yet</h3>
                    <p>Start planning your visits by clicking "New Visit"</p>
                </div>
            </div>
        </section>

        <!-- ==================== TEACHER TRAINING SECTION ==================== -->
        <section class="content-section" id="section-training">
            <div class="section-header">
                <div>
                    <h1><i class="fas fa-chalkboard-teacher"></i> Teacher Training</h1>
                    <p class="section-subtitle">Manage workshops, sessions, and training programs</p>
                </div>
                <div class="header-actions">
                    <button class="btn btn-primary" onclick="openTrainingModal()">
                        <i class="fas fa-plus"></i> New Training
                    </button>
                </div>
            </div>

            <div class="filter-bar">
                <div class="filter-group">
                    <select id="trainingStatusFilter" onchange="_pageState.trainings=1;renderTrainings()">
                        <option value="all">All Status</option>
                        <option value="upcoming">Upcoming</option>
                        <option value="completed">Completed</option>
                        <option value="ongoing">Ongoing</option>
                    </select>
                    <input type="text" id="trainingSearchInput" placeholder="Search trainings..."
                        oninput="_pageState.trainings=1;renderTrainings()">
                </div>
            </div>

            <div id="trainingsContainer" class="trainings-grid">
                <div class="empty-state">
                    <i class="fas fa-chalkboard-teacher"></i>
                    <h3>No training sessions yet</h3>
                    <p>Create your first training by clicking "New Training"</p>
                </div>
            </div>
        </section>

        <!-- ==================== OBSERVATIONS SECTION ==================== -->
        <section class="content-section" id="section-observations">
            <div class="section-header">
                <div>
                    <h1><i class="fas fa-clipboard-check"></i> Field Notes & Observations</h1>
                    <p class="section-subtitle">Capture classroom observations, teaching practices & field notes</p>
                </div>
                <div class="header-actions">
                    <div class="obs-import-dropdown">
                        <button class="btn btn-outline" onclick="toggleObsImportMenu()" id="obsImportBtn">
                            <i class="fas fa-file-excel"></i> Import / Manage <i class="fas fa-caret-down" style="margin-left:4px;font-size:11px"></i>
                        </button>
                        <div class="obs-import-menu" id="obsImportMenu">
                            <div class="obs-menu-label"><i class="fas fa-download"></i> Import</div>
                            <button onclick="triggerDMTImport('add')"><i class="fas fa-plus-circle"></i> Import DMT (Add to existing)</button>
                            <button onclick="triggerDMTImport('replace')"><i class="fas fa-sync-alt"></i> Import DMT (Replace all)</button>
                            <button onclick="triggerFilteredImport()"><i class="fas fa-filter"></i> Import DMT (Filtered â€” State/Block/Observer/Cluster)</button>
                            <div class="obs-import-menu-divider"></div>
                            <div class="obs-menu-label"><i class="fas fa-address-book"></i> Contacts & Schools</div>
                            <button onclick="extractContactsFromObservations()"><i class="fas fa-user-plus"></i> Extract Contacts from Observations</button>
                            <button onclick="triggerSchoolProfileImport()"><i class="fas fa-school"></i> Import School Profiles from Excel</button>
                            <div class="obs-import-menu-divider"></div>
                            <div class="obs-menu-label"><i class="fas fa-upload"></i> Unload</div>
                            <button onclick="openUnloadModal()"><i class="fas fa-filter"></i> Unload by Filter (State/Block/Observer/Cluster)</button>
                            <button onclick="unloadImportedData()" class="obs-menu-danger"><i class="fas fa-eraser"></i> Unload All Imported Data</button>
                            <div class="obs-import-menu-divider"></div>
                            <button onclick="clearAllObservations()" class="obs-menu-danger"><i class="fas fa-trash-alt"></i> Clear All Observations</button>
                        </div>
                    </div>
                    <input type="file" id="dmtImportFile" accept=".xlsx,.xls,.csv" style="display:none" onchange="importDMTExcel(event)">
                    <input type="file" id="dmtFilteredImportFile" accept=".xlsx,.xls,.csv" style="display:none" onchange="loadFilteredImportPreview(event)">
                    <button class="btn btn-primary" onclick="openObservationModal()">
                        <i class="fas fa-plus"></i> New Observation
                    </button>
                </div>
            </div>

            <!-- Summary Stats Bar -->
            <div class="obs-stats-bar" id="obsStatsBar">
                <div class="obs-stat-pill"><i class="fas fa-clipboard-list"></i> <span id="obsStatTotal">0</span> Total</div>
                <div class="obs-stat-pill"><i class="fas fa-school"></i> <span id="obsStatSchools">0</span> Schools</div>
                <div class="obs-stat-pill"><i class="fas fa-chalkboard-teacher"></i> <span id="obsStatTeachers">0</span> Teachers</div>
                <div class="obs-stat-pill"><i class="fas fa-eye"></i> <span id="obsStatObserved">0</span> Observed</div>
                <div class="obs-stat-pill engagement"><i class="fas fa-fire"></i> <span id="obsStatEngaged">0%</span> Engaged</div>
            </div>

            <!-- Filter Bar -->
            <div class="filter-bar obs-filter-bar">
                <div class="filter-group">
                    <select id="observationSubjectFilter" onchange="renderObservations()">
                        <option value="all">All Subjects</option>
                        <option value="Math">Math</option>
                        <option value="Hindi">Hindi</option>
                        <option value="English">English</option>
                        <option value="ECE">ECE</option>
                        <option value="Mathematics">Mathematics</option>
                        <option value="Science">Science</option>
                        <option value="Language">Language</option>
                        <option value="Social Science">Social Science</option>
                        <option value="EVS">EVS</option>
                        <option value="Other">Other</option>
                    </select>
                    <select id="observationEngagementFilter" onchange="renderObservations()">
                        <option value="all">All Engagement</option>
                        <option value="More Engaged">More Engaged</option>
                        <option value="Engaged">Engaged</option>
                        <option value="Not Engaged">Not Engaged</option>
                    </select>
                    <select id="observationTypeFilter" onchange="renderObservations()">
                        <option value="all">All Practice Types</option>
                        <option value="Teaching Practice">Teaching Practice</option>
                        <option value="Common Practice">Common Practice</option>
                        <option value="Learning Outcome">Learning Outcome</option>
                    </select>
                    <select id="observationBlockFilter" onchange="renderObservations()">
                        <option value="all">All Blocks</option>
                    </select>
                    <select id="observationObsFilter" onchange="renderObservations()">
                        <option value="all">All Status</option>
                        <option value="Yes">Observed</option>
                        <option value="Not_Observed">Not Observed</option>
                        <option value="No">Not Done</option>
                    </select>
                    <input type="text" id="observationSearchInput" placeholder="Search school, teacher, practice..."
                        oninput="renderObservations()">
                </div>
            </div>

            <!-- Tabs: List / Analytics / Smart Planner -->
            <div class="obs-tabs">
                <button class="obs-tab active" data-tab="list" onclick="switchObsTab('list')"><i class="fas fa-list"></i> List View</button>
                <button class="obs-tab" data-tab="analytics" onclick="switchObsTab('analytics')"><i class="fas fa-chart-pie"></i> Analytics</button>
                <button class="obs-tab" data-tab="planner" onclick="switchObsTab('planner')"><i class="fas fa-brain"></i> Smart Planner</button>
                <button class="obs-tab" data-tab="aianalysis" onclick="switchObsTab('aianalysis')"><i class="fas fa-robot"></i> AI Analysis</button>
            </div>

            <!-- List View -->
            <div id="obsTabList" class="obs-tab-content active">
                <div id="observationsContainer" class="observations-list">
                    <div class="empty-state">
                        <i class="fas fa-clipboard-check"></i>
                        <h3>No observations recorded</h3>
                        <p>Start documenting classroom observations or import a DMT Excel file</p>
                    </div>
                </div>
            </div>

            <!-- Analytics View -->
            <div id="obsTabAnalytics" class="obs-tab-content">
                <div class="obs-analytics-grid" id="obsAnalyticsGrid">
                    <div class="obs-chart-card">
                        <h3><i class="fas fa-chart-pie"></i> Engagement Distribution</h3>
                        <canvas id="obsChartEngagement"></canvas>
                    </div>
                    <div class="obs-chart-card">
                        <h3><i class="fas fa-chart-bar"></i> Observations by Subject</h3>
                        <canvas id="obsChartSubject"></canvas>
                    </div>
                    <div class="obs-chart-card">
                        <h3><i class="fas fa-chart-bar"></i> Practice Type Distribution</h3>
                        <canvas id="obsChartPracticeType"></canvas>
                    </div>
                    <div class="obs-chart-card">
                        <h3><i class="fas fa-chart-bar"></i> Block-wise Observations</h3>
                        <canvas id="obsChartBlock"></canvas>
                    </div>
                    <div class="obs-chart-card">
                        <h3><i class="fas fa-chart-line"></i> Monthly Observation Trend</h3>
                        <canvas id="obsChartTrend"></canvas>
                    </div>
                    <div class="obs-chart-card">
                        <h3><i class="fas fa-chart-bar"></i> Observation Status</h3>
                        <canvas id="obsChartStatus"></canvas>
                    </div>
                    <div class="obs-chart-card obs-chart-wide">
                        <h3><i class="fas fa-chart-bar"></i> Top 15 Practices Observed</h3>
                        <canvas id="obsChartPractices"></canvas>
                    </div>
                    <div class="obs-chart-card obs-chart-wide">
                        <h3><i class="fas fa-chalkboard-teacher"></i> Top Observers</h3>
                        <canvas id="obsChartObservers"></canvas>
                    </div>
                </div>
            </div>

            <!-- Smart Planner View -->
            <div id="obsTabPlanner" class="obs-tab-content">
                <div id="smartPlannerContainer" class="smart-planner-container">
                    <div class="empty-state"><i class="fas fa-brain"></i><h3>Loading Smart Planner...</h3><p>Analyzing your observation data to generate intelligent suggestions</p></div>
                </div>
            </div>

            <!-- AI Analysis View -->
            <div id="obsTabAianalysis" class="obs-tab-content">
                <div id="aiAnalysisContainer" class="ai-analysis-container">

                    <!-- Hero -->
                    <div class="ai-hero">
                        <div class="ai-hero-icon"><i class="fas fa-wand-magic-sparkles"></i></div>
                        <h2>AI Analysis</h2>
                        <p>Generate a smart prompt from your data, send it to any AI chatbot, and get actionable plans</p>
                    </div>

                    <!-- Steps Workflow -->
                    <div class="ai-workflow">

                        <!-- Step 1 â€” Generate -->
                        <div class="ai-step" id="aiStep1">
                            <div class="ai-step-header">
                                <span class="ai-step-num">1</span>
                                <div class="ai-step-title">
                                    <h3>Choose Focus & Generate Prompt</h3>
                                    <p>Select what you want AI to analyze, then generate the prompt</p>
                                </div>
                            </div>
                            <div class="ai-step-body">
                                <div class="ai-prompt-options">
                                    <div class="ai-opt-chips">
                                        <button class="ai-chip active" onclick="setAiPromptFocus('full')" data-focus="full"><i class="fas fa-globe"></i> Full Analysis</button>
                                        <button class="ai-chip" onclick="setAiPromptFocus('engagement')" data-focus="engagement"><i class="fas fa-fire"></i> Engagement</button>
                                        <button class="ai-chip" onclick="setAiPromptFocus('teacher')" data-focus="teacher"><i class="fas fa-user"></i> Teacher Support</button>
                                        <button class="ai-chip" onclick="setAiPromptFocus('school')" data-focus="school"><i class="fas fa-school"></i> School Visits</button>
                                        <button class="ai-chip" onclick="setAiPromptFocus('training')" data-focus="training"><i class="fas fa-chalkboard-teacher"></i> Training Needs</button>
                                    </div>
                                </div>
                                <button class="btn btn-primary ai-generate-btn" onclick="generateAiPrompt()" id="aiAnalyzeBtn">
                                    <i class="fas fa-bolt"></i> Generate Prompt
                                </button>
                                <!-- Prompt Output -->
                                <div id="aiPromptOutput" class="ai-prompt-output" style="display:none">
                                    <div class="ai-prompt-toolbar">
                                        <span class="ai-prompt-badge"><i class="fas fa-check-circle"></i> Prompt Ready</span>
                                        <div>
                                            <button class="btn btn-sm btn-outline" onclick="copyAiPrompt()"><i class="fas fa-copy"></i> Copy</button>
                                        </div>
                                    </div>
                                    <pre id="aiPromptText" class="ai-prompt-pre"></pre>
                                </div>
                            </div>
                        </div>

                        <!-- Step 2 â€” Send to AI -->
                        <div class="ai-step" id="aiStep2">
                            <div class="ai-step-header">
                                <span class="ai-step-num">2</span>
                                <div class="ai-step-title">
                                    <h3>Send to Any AI Chatbot</h3>
                                    <p>Copy the prompt and paste it into your favorite AI</p>
                                </div>
                            </div>
                            <div class="ai-step-body">
                                <div class="ai-chatbot-links">
                                    <a href="https://chatgpt.com" target="_blank" class="ai-chatbot-link chatgpt"><i class="fas fa-comment-dots"></i> ChatGPT</a>
                                    <a href="https://claude.ai" target="_blank" class="ai-chatbot-link claude"><i class="fas fa-brain"></i> Claude</a>
                                    <a href="https://gemini.google.com" target="_blank" class="ai-chatbot-link gemini"><i class="fas fa-star"></i> Gemini</a>
                                    <a href="https://chat.deepseek.com" target="_blank" class="ai-chatbot-link deepseek"><i class="fas fa-water"></i> DeepSeek</a>
                                    <a href="https://copilot.microsoft.com" target="_blank" class="ai-chatbot-link copilot"><i class="fas fa-windows"></i> Copilot</a>
                                </div>
                                <div class="ai-step-hint"><i class="fas fa-info-circle"></i> Paste the copied prompt, wait for the full response, then copy the AI's reply</div>
                            </div>
                        </div>

                        <!-- Step 3 â€” Paste Response -->
                        <div class="ai-step" id="aiStep3">
                            <div class="ai-step-header">
                                <span class="ai-step-num">3</span>
                                <div class="ai-step-title">
                                    <h3>Paste AI Response & Parse</h3>
                                    <p>Paste the full AI response below and convert it to actionable plans</p>
                                </div>
                            </div>
                            <div class="ai-step-body">
                                <textarea id="aiResponseInput" class="ai-response-textarea" rows="8" placeholder="Paste the AI's complete response here..."></textarea>
                                <div class="ai-response-actions">
                                    <button class="btn btn-primary" onclick="parseAiResponse()"><i class="fas fa-cogs"></i> Parse & Build Plans</button>
                                    <button class="btn btn-outline btn-sm" onclick="document.getElementById('aiResponseInput').value=''" title="Clear"><i class="fas fa-eraser"></i> Clear</button>
                                </div>
                            </div>
                        </div>

                    </div><!-- /.ai-workflow -->

                    <!-- AI Results -->
                    <div id="aiResultsContainer" style="display:none">
                        <div class="ai-results-header">
                            <h3><i class="fas fa-chart-line"></i> Analysis Results</h3>
                            <div class="ai-results-actions-top">
                                <button class="btn btn-sm btn-outline" onclick="scrollToAiStep(1)"><i class="fas fa-redo"></i> New Analysis</button>
                                <button class="btn btn-sm btn-outline" onclick="toggleAiRawResponse()"><i class="fas fa-code"></i> Raw</button>
                                <button class="btn btn-sm btn-primary" onclick="aiPushAllPlans()"><i class="fas fa-paper-plane"></i> Push All</button>
                            </div>
                        </div>
                        <div id="aiPlansContainer"></div>
                        <div class="ai-plans-actions" id="aiPlansActions" style="display:none">
                            <button class="btn btn-primary" onclick="aiPushAllPlans()"><i class="fas fa-paper-plane"></i> Push All to Dashboard</button>
                        </div>
                        <div class="ai-raw-response" id="aiRawResponse" style="display:none">
                            <pre id="aiRawResponseText" class="ai-prompt-pre"></pre>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <section class="content-section" id="section-reports">
            <div class="section-header">
                <div>
                    <h1><i class="fas fa-chart-bar"></i> Reports</h1>
                    <p class="section-subtitle">Generate and view summary reports</p>
                </div>
            </div>

            <div class="reports-controls">
                <div class="report-type-selector">
                    <button class="report-type-btn active" data-type="monthly" onclick="setReportType('monthly')">
                        <i class="fas fa-calendar-alt"></i> Monthly Report
                    </button>
                    <button class="report-type-btn" data-type="school" onclick="setReportType('school')">
                        <i class="fas fa-school"></i> School Report
                    </button>
                    <button class="report-type-btn" data-type="summary" onclick="setReportType('summary')">
                        <i class="fas fa-chart-pie"></i> Summary
                    </button>
                </div>
                <div class="report-filters">
                    <select id="reportMonthFilter">
                        <option value="0">January</option>
                        <option value="1">February</option>
                        <option value="2">March</option>
                        <option value="3">April</option>
                        <option value="4">May</option>
                        <option value="5">June</option>
                        <option value="6">July</option>
                        <option value="7">August</option>
                        <option value="8">September</option>
                        <option value="9">October</option>
                        <option value="10">November</option>
                        <option value="11">December</option>
                    </select>
                    <select id="reportYearFilter"></select>
                    <button class="btn btn-primary" onclick="generateReport()">
                        <i class="fas fa-cog"></i> Generate
                    </button>
                    <button class="btn btn-outline" onclick="printReport()">
                        <i class="fas fa-print"></i> Print
                    </button>
                </div>
            </div>

            <div id="reportOutput" class="report-output">
                <div class="empty-state">
                    <i class="fas fa-chart-bar"></i>
                    <h3>Select report type and generate</h3>
                    <p>Choose a report type above and click Generate</p>
                </div>
            </div>
        </section>

        <!-- ==================== RESOURCE LIBRARY SECTION ==================== -->
        <section class="content-section" id="section-resources">
            <div class="section-header">
                <div>
                    <h1><i class="fas fa-book-open"></i> Resource Library</h1>
                    <p class="section-subtitle">Organize teaching and learning materials</p>
                </div>
                <div class="header-actions">
                    <button class="btn btn-primary" onclick="openResourceModal()">
                        <i class="fas fa-plus"></i> Add Resource
                    </button>
                </div>
            </div>

            <div class="filter-bar">
                <div class="filter-group">
                    <select id="resourceTypeFilter" onchange="_pageState.resources=1;renderResources()">
                        <option value="all">All Types</option>
                        <option value="Worksheet">Worksheet</option>
                        <option value="Lesson Plan">Lesson Plan</option>
                        <option value="Activity">Activity</option>
                        <option value="Reference">Reference Material</option>
                        <option value="TLM">Teaching-Learning Material</option>
                        <option value="Video">Video</option>
                        <option value="Other">Other</option>
                    </select>
                    <select id="resourceSubjectFilter" onchange="_pageState.resources=1;renderResources()">
                        <option value="all">All Subjects</option>
                        <option value="Mathematics">Mathematics</option>
                        <option value="Science">Science</option>
                        <option value="Language">Language</option>
                        <option value="Social Science">Social Science</option>
                        <option value="EVS">EVS</option>
                        <option value="Other">Other</option>
                    </select>
                    <input type="text" id="resourceSearchInput" placeholder="Search resources..."
                        oninput="_pageState.resources=1;renderResources()">
                </div>
            </div>

            <div id="resourcesContainer" class="resources-grid">
                <div class="empty-state">
                    <i class="fas fa-book-open"></i>
                    <h3>No resources added yet</h3>
                    <p>Build your resource library by clicking "Add Resource"</p>
                </div>
            </div>
        </section>

        <!-- ==================== EXCEL ANALYTICS SECTION ==================== -->
        <section class="content-section" id="section-excel">
            <div class="section-header">
                <div>
                    <h1><i class="fas fa-chart-line"></i> Excel Analytics</h1>
                    <p class="section-subtitle">Upload any spreadsheet â€” get instant dashboards, charts &amp; insights</p>
                </div>
                <div class="header-actions">
                    <button class="btn btn-primary" onclick="generateSmartReport()" id="generateReportBtn" style="display:none;">
                        <i class="fas fa-file-alt"></i> Smart Report
                    </button>
                    <button class="btn btn-outline" onclick="clearExcelData()" id="clearExcelBtn" style="display:none;">
                        <i class="fas fa-times"></i> Clear Data
                    </button>
                </div>
            </div>

            <!-- Upload Area -->
            <div class="excel-upload-zone" id="excelUploadZone">
                <div class="upload-content">
                    <div class="upload-icon-ring">
                        <div class="upload-icon-inner">
                            <i class="fas fa-file-excel"></i>
                        </div>
                    </div>
                    <h3>Drop your spreadsheet here</h3>
                    <p>Supports <strong>.xlsx</strong>, <strong>.xls</strong> &amp; <strong>.csv</strong> files</p>
                    <button class="btn btn-primary upload-browse-btn" onclick="document.getElementById('excelFileInput').click()">
                        <i class="fas fa-folder-open"></i> Browse Files
                    </button>
                    <input type="file" id="excelFileInput" accept=".xlsx,.xls,.csv" style="display:none"
                        onchange="handleExcelUpload(event)">
                    <div class="upload-formats">
                        <span><i class="fas fa-shield-alt"></i> Processed locally â€” nothing uploaded</span>
                    </div>
                </div>
            </div>

            <!-- Sheet Selector (shown after upload) -->
            <div class="excel-sheet-bar" id="excelSheetSelector" style="display:none;">
                <div class="sheet-file-info">
                    <div class="sheet-file-icon"><i class="fas fa-file-excel"></i></div>
                    <div>
                        <strong id="excelFileName">file.xlsx</strong>
                        <span id="excelFileInfo" class="text-muted"></span>
                    </div>
                </div>
                <div class="sheet-tabs" id="excelSheetTabs"></div>
            </div>

            <!-- Excel Dashboard -->
            <div id="excelDashboard" style="display:none;">
                <!-- Summary Stats -->
                <div class="excel-kpi-strip" id="excelSummaryBar"></div>

                <!-- Analysis Tabs -->
                <div class="excel-tab-bar">
                    <button class="excel-tab active" onclick="switchAnalysisTab('auto')" data-tab="auto">
                        <i class="fas fa-magic"></i> <span>Auto Analysis</span>
                    </button>
                    <button class="excel-tab" onclick="switchAnalysisTab('stats')" data-tab="stats">
                        <i class="fas fa-square-root-alt"></i> <span>Statistics</span>
                    </button>
                    <button class="excel-tab" onclick="switchAnalysisTab('correlation')" data-tab="correlation">
                        <i class="fas fa-project-diagram"></i> <span>Correlations</span>
                    </button>
                    <button class="excel-tab" onclick="switchAnalysisTab('outliers')" data-tab="outliers">
                        <i class="fas fa-exclamation-triangle"></i> <span>Outliers</span>
                    </button>
                    <button class="excel-tab" onclick="switchAnalysisTab('distribution')" data-tab="distribution">
                        <i class="fas fa-wave-square"></i> <span>Distribution</span>
                    </button>
                    <button class="excel-tab" onclick="switchAnalysisTab('trends')" data-tab="trends">
                        <i class="fas fa-chart-line"></i> <span>Trends</span>
                    </button>
                    <button class="excel-tab" onclick="switchAnalysisTab('custom')" data-tab="custom">
                        <i class="fas fa-paint-brush"></i> <span>Chart Builder</span>
                    </button>
                    <button class="excel-tab" onclick="switchAnalysisTab('pivot')" data-tab="pivot">
                        <i class="fas fa-th"></i> <span>Pivot Table</span>
                    </button>
                    <button class="excel-tab" onclick="switchAnalysisTab('quality')" data-tab="quality">
                        <i class="fas fa-heartbeat"></i> <span>Data Quality</span>
                    </button>
                </div>

                <!-- TAB: Auto Analysis -->
                <div class="analysis-panel active" id="panel-auto">
                    <div class="excel-insights-panel" id="excelInsightsPanel"></div>
                    <div class="excel-charts-grid" id="excelChartsGrid"></div>
                </div>

                <!-- TAB: Statistical Deep Dive -->
                <div class="analysis-panel" id="panel-stats">
                    <div class="tab-custom-controls">
                        <div class="ctrl-section">
                            <div class="custom-control-group">
                                <label><i class="fas fa-columns"></i> Columns</label>
                                <select id="statsColumnFilter" multiple></select>
                                <button class="ctrl-multi-btn" onclick="toggleCtrlMulti(this, 'statsColumnFilter')">
                                    <span class="ctrl-multi-label">All Columns</span>
                                    <span class="ctrl-count">0</span>
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                                <div class="ctrl-multi-dropdown" id="statsColumnFilter-dropdown"></div>
                            </div>
                        </div>
                        <div class="ctrl-section">
                            <div class="custom-control-group">
                                <label><i class="fas fa-sort"></i> Sort By</label>
                                <select id="statsSortBy">
                                    <option value="name">Name</option>
                                    <option value="mean">Mean</option>
                                    <option value="stddev">Std Dev</option>
                                    <option value="missing">Missing %</option>
                                    <option value="cv">CV %</option>
                                </select>
                            </div>
                        </div>
                        <div class="ctrl-section ctrl-actions">
                            <button class="tab-action-btn primary" onclick="renderStatistics()">
                                <i class="fas fa-sync-alt"></i> Apply
                            </button>
                            <button class="tab-action-btn" onclick="exportTabToCSV('stats')">
                                <i class="fas fa-download"></i> Export
                            </button>
                        </div>
                    </div>
                    <div id="statsOutput"></div>
                </div>

                <!-- TAB: Correlation Matrix -->
                <div class="analysis-panel" id="panel-correlation">
                    <div class="tab-custom-controls">
                        <div class="ctrl-section">
                            <div class="custom-control-group">
                                <label><i class="fas fa-sliders-h"></i> Threshold</label>
                                <select id="corrMinThreshold">
                                    <option value="0">Show All</option>
                                    <option value="0.3">|r| â‰¥ 0.3 (Weak+)</option>
                                    <option value="0.5" selected>|r| â‰¥ 0.5 (Moderate+)</option>
                                    <option value="0.7">|r| â‰¥ 0.7 (Strong+)</option>
                                </select>
                            </div>
                        </div>
                        <div class="ctrl-section">
                            <div class="custom-control-group">
                                <label><i class="fas fa-hashtag"></i> Max Cols</label>
                                <select id="corrMaxCols">
                                    <option value="8">8</option>
                                    <option value="12">12</option>
                                    <option value="15" selected>15</option>
                                    <option value="20">20</option>
                                </select>
                            </div>
                        </div>
                        <div class="ctrl-section ctrl-actions">
                            <button class="tab-action-btn primary" onclick="renderCorrelationMatrix()">
                                <i class="fas fa-sync-alt"></i> Apply
                            </button>
                            <button class="tab-action-btn" onclick="exportTabToCSV('correlation')">
                                <i class="fas fa-download"></i> Export
                            </button>
                        </div>
                    </div>
                    <div id="correlationOutput"></div>
                </div>

                <!-- TAB: Outlier Detection -->
                <div class="analysis-panel" id="panel-outliers">
                    <div class="tab-custom-controls">
                        <div class="ctrl-section">
                            <div class="custom-control-group">
                                <label><i class="fas fa-ruler-combined"></i> Method</label>
                                <select id="outlierMethod">
                                    <option value="iqr" selected>IQR (1.5Ã—)</option>
                                    <option value="zscore">Z-Score (2.5Ïƒ)</option>
                                    <option value="extreme">Extreme (3Ã— IQR)</option>
                                </select>
                            </div>
                        </div>
                        <div class="ctrl-section">
                            <div class="custom-control-group">
                                <label><i class="fas fa-eye"></i> Filter</label>
                                <select id="outlierShow">
                                    <option value="all">All Columns</option>
                                    <option value="with">With Outliers Only</option>
                                </select>
                            </div>
                        </div>
                        <div class="ctrl-section ctrl-actions">
                            <button class="tab-action-btn primary" onclick="renderOutlierDetection()">
                                <i class="fas fa-sync-alt"></i> Apply
                            </button>
                            <button class="tab-action-btn" onclick="exportTabToCSV('outliers')">
                                <i class="fas fa-download"></i> Export
                            </button>
                        </div>
                    </div>
                    <div id="outlierOutput"></div>
                </div>

                <!-- TAB: Distribution Analysis -->
                <div class="analysis-panel" id="panel-distribution">
                    <div class="tab-custom-controls">
                        <div class="ctrl-section">
                            <div class="custom-control-group">
                                <label><i class="fas fa-chart-bar"></i> Bins</label>
                                <select id="distBinCount">
                                    <option value="auto" selected>Auto</option>
                                    <option value="10">10 bins</option>
                                    <option value="15">15 bins</option>
                                    <option value="20">20 bins</option>
                                    <option value="30">30 bins</option>
                                    <option value="50">50 bins</option>
                                </select>
                            </div>
                        </div>
                        <div class="ctrl-section">
                            <div class="custom-control-group">
                                <label><i class="fas fa-list-ol"></i> Top N</label>
                                <select id="distTopN">
                                    <option value="5">Top 5</option>
                                    <option value="10" selected>Top 10</option>
                                    <option value="15">Top 15</option>
                                    <option value="20">Top 20</option>
                                    <option value="all">All</option>
                                </select>
                            </div>
                        </div>
                        <div class="ctrl-section ctrl-actions">
                            <button class="tab-action-btn primary" onclick="renderDistributionAnalysis()">
                                <i class="fas fa-sync-alt"></i> Apply
                            </button>
                            <button class="tab-action-btn" onclick="exportTabToCSV('distribution')">
                                <i class="fas fa-download"></i> Export
                            </button>
                        </div>
                    </div>
                    <div id="distributionOutput"></div>
                </div>

                <!-- TAB: Trends & Time Series -->
                <div class="analysis-panel" id="panel-trends">
                    <div class="tab-custom-controls">
                        <div class="ctrl-section">
                            <div class="custom-control-group">
                                <label><i class="fas fa-calendar-alt"></i> Group</label>
                                <select id="trendGroupBy">
                                    <option value="auto" selected>Auto Detect</option>
                                    <option value="day">Day</option>
                                    <option value="week">Week</option>
                                    <option value="month">Month</option>
                                    <option value="year">Year</option>
                                </select>
                            </div>
                        </div>
                        <div class="ctrl-section">
                            <div class="custom-control-group">
                                <label><i class="fas fa-chart-line"></i> MA Window</label>
                                <select id="trendMAWindow">
                                    <option value="auto" selected>Auto</option>
                                    <option value="3">3 periods</option>
                                    <option value="5">5 periods</option>
                                    <option value="7">7 periods</option>
                                    <option value="10">10 periods</option>
                                </select>
                            </div>
                        </div>
                        <div class="ctrl-section ctrl-actions">
                            <button class="tab-action-btn primary" onclick="renderTrendAnalysis()">
                                <i class="fas fa-sync-alt"></i> Apply
                            </button>
                            <button class="tab-action-btn" onclick="exportTabToCSV('trends')">
                                <i class="fas fa-download"></i> Export
                            </button>
                        </div>
                    </div>
                    <div id="trendsOutput"></div>
                </div>

                <!-- TAB: Custom Chart Builder -->
                <div class="analysis-panel" id="panel-custom">
                    <div class="excel-builder-card">
                        <div class="builder-card-header">
                            <div class="builder-card-icon"><i class="fas fa-paint-brush"></i></div>
                            <div>
                                <h3>Chart Builder</h3>
                                <p>Configure axes, aggregation &amp; visualization type</p>
                            </div>
                        </div>
                        <div class="builder-card-body">
                            <div class="builder-grid">
                                <div class="form-group">
                                    <label><i class="fas fa-chart-pie"></i> Chart Type</label>
                                    <select id="customChartType">
                                        <option value="bar">Bar Chart</option>
                                        <option value="line">Line Chart</option>
                                        <option value="pie">Pie / Doughnut</option>
                                        <option value="radar">Radar Chart</option>
                                        <option value="scatter">Scatter Plot</option>
                                        <option value="histogram">Histogram</option>
                                        <option value="polarArea">Polar Area</option>
                                        <option value="horizontalBar">Horizontal Bar</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label><i class="fas fa-arrows-alt-h"></i> X-Axis / Labels</label>
                                    <select id="customChartX"></select>
                                </div>
                                <div class="form-group">
                                    <label><i class="fas fa-arrows-alt-v"></i> Y-Axis / Values</label>
                                    <select id="customChartY"></select>
                                </div>
                                <div class="form-group">
                                    <label><i class="fas fa-calculator"></i> Aggregation</label>
                                    <select id="customChartAgg">
                                        <option value="sum">Sum</option>
                                        <option value="average">Average</option>
                                        <option value="count">Count</option>
                                        <option value="min">Min</option>
                                        <option value="max">Max</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label><i class="fas fa-layer-group"></i> Group By</label>
                                    <select id="customChartGroup">
                                        <option value="">â€” None â€”</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label><i class="fas fa-filter"></i> Top N</label>
                                    <select id="customChartTopN">
                                        <option value="10">Top 10</option>
                                        <option value="15">Top 15</option>
                                        <option value="20" selected>Top 20</option>
                                        <option value="50">Top 50</option>
                                        <option value="all">All</option>
                                    </select>
                                </div>
                            </div>
                            <button class="btn btn-primary builder-generate-btn" onclick="buildCustomChart()">
                                <i class="fas fa-bolt"></i> Generate Chart
                            </button>
                        </div>
                    </div>
                    <div id="customChartOutput" style="margin-top:20px;"></div>
                </div>

                <!-- TAB: Pivot Analysis -->
                <div class="analysis-panel" id="panel-pivot">
                    <div class="excel-builder-card">
                        <div class="builder-card-header">
                            <div class="builder-card-icon" style="background:linear-gradient(135deg, #6366f1, #4f46e5);"><i class="fas fa-th"></i></div>
                            <div>
                                <h3>Pivot Table</h3>
                                <p>Cross-tabulate and aggregate your data</p>
                            </div>
                        </div>
                        <div class="builder-card-body">
                            <div class="builder-grid">
                                <div class="form-group">
                                    <label><i class="fas fa-grip-lines"></i> Row (Group By)</label>
                                    <select id="pivotRow"></select>
                                </div>
                                <div class="form-group">
                                    <label><i class="fas fa-sort-numeric-up"></i> Value Column</label>
                                    <select id="pivotValue"></select>
                                </div>
                                <div class="form-group">
                                    <label><i class="fas fa-calculator"></i> Aggregation</label>
                                    <select id="pivotAgg">
                                        <option value="sum">Sum</option>
                                        <option value="average">Average</option>
                                        <option value="count">Count</option>
                                        <option value="min">Min</option>
                                        <option value="max">Max</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label><i class="fas fa-columns"></i> Column Split</label>
                                    <select id="pivotCol">
                                        <option value="">â€” None â€”</option>
                                    </select>
                                </div>
                            </div>
                            <button class="btn btn-primary builder-generate-btn" onclick="buildPivotTable()" style="background:linear-gradient(135deg, #6366f1, #4f46e5);">
                                <i class="fas fa-table"></i> Generate Pivot
                            </button>
                        </div>
                    </div>
                    <div id="pivotOutput" style="margin-top:20px;"></div>
                </div>

                <!-- TAB: Data Quality -->
                <div class="analysis-panel" id="panel-quality">
                    <div id="dataQualityOutput"></div>
                </div>

                <!-- Data Table Preview -->
                <div class="excel-table-card" style="margin-top:24px;">
                    <div class="excel-table-header">
                        <h3><i class="fas fa-table"></i> Data Preview</h3>
                        <span class="text-muted" id="excelRowCount"></span>
                    </div>
                    <div class="excel-table-body">
                        <div id="excelTableContainer"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ==================== QUICK NOTES SECTION ==================== -->
        <section class="content-section" id="section-notes">
            <div class="section-header">
                <div>
                    <h1><i class="fas fa-sticky-note"></i> Quick Notes</h1>
                    <p class="section-subtitle">Jot down ideas, reminders, and to-do items</p>
                </div>
                <div class="header-actions">
                    <button class="btn btn-primary" onclick="addNewNote()">
                        <i class="fas fa-plus"></i> New Note
                    </button>
                </div>
            </div>

            <div id="notesContainer" class="notes-grid">
                <div class="empty-state">
                    <i class="fas fa-sticky-note"></i>
                    <h3>No notes yet</h3>
                    <p>Click "New Note" to start jotting things down</p>
                </div>
            </div>
        </section>

        <!-- ==================== WEEKLY PLANNER SECTION ==================== -->
        <section class="content-section" id="section-planner">
            <div class="section-header">
                <div>
                    <h1><i class="fas fa-calendar-week"></i> Weekly Planner</h1>
                    <p class="section-subtitle">Plan your school visits, trainings, and field work for the week</p>
                </div>
                <div class="header-actions">
                    <button class="btn btn-outline" onclick="navigatePlannerWeek(-1)">
                        <i class="fas fa-chevron-left"></i> Prev Week
                    </button>
                    <button class="btn btn-outline" onclick="navigatePlannerWeek(0)">
                        <i class="fas fa-calendar-day"></i> This Week
                    </button>
                    <button class="btn btn-outline" onclick="navigatePlannerWeek(1)">
                        Next Week <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>

            <div class="planner-week-header" id="plannerWeekHeader"></div>
            <div class="planner-grid" id="plannerGrid"></div>
        </section>

        <!-- ==================== GOAL TRACKER SECTION ==================== -->
        <section class="content-section" id="section-goals">
            <div class="section-header">
                <div>
                    <h1><i class="fas fa-bullseye"></i> Goal Tracker</h1>
                    <p class="section-subtitle">Set and track your monthly targets for field activities</p>
                </div>
                <div class="header-actions">
                    <select id="goalMonth" class="filter-select" onchange="renderGoals()"></select>
                    <button class="btn btn-primary" onclick="saveGoalTargets()">
                        <i class="fas fa-save"></i> Save Targets
                    </button>
                </div>
            </div>

            <!-- Goal Progress Cards -->
            <div class="goals-progress-grid" id="goalsProgressGrid"></div>

            <!-- Goal Inputs -->
            <div class="card" style="margin-top:20px;">
                <div class="card-header">
                    <h3><i class="fas fa-sliders-h"></i> Set Monthly Targets</h3>
                </div>
                <div class="card-body">
                    <div class="goal-targets-form" id="goalTargetsForm">
                        <div class="goal-target-row">
                            <label><i class="fas fa-school"></i> School Visits</label>
                            <input type="number" id="goalVisits" min="0" max="100" value="15"
                                placeholder="Target visits">
                        </div>
                        <div class="goal-target-row">
                            <label><i class="fas fa-chalkboard-teacher"></i> Training Sessions</label>
                            <input type="number" id="goalTrainings" min="0" max="50" value="4"
                                placeholder="Target trainings">
                        </div>
                        <div class="goal-target-row">
                            <label><i class="fas fa-clipboard-check"></i> Observations</label>
                            <input type="number" id="goalObservations" min="0" max="100" value="10"
                                placeholder="Target observations">
                        </div>
                        <div class="goal-target-row">
                            <label><i class="fas fa-users"></i> Teachers Reached</label>
                            <input type="number" id="goalTeachers" min="0" max="500" value="50"
                                placeholder="Target teachers">
                        </div>
                        <div class="goal-target-row">
                            <label><i class="fas fa-book-open"></i> Resources Created</label>
                            <input type="number" id="goalResources" min="0" max="50" value="5"
                                placeholder="Target resources">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Monthly Activity Chart -->
            <div class="card" style="margin-top:20px;">
                <div class="card-header">
                    <h3><i class="fas fa-chart-line"></i> Monthly Activity Trend</h3>
                </div>
                <div class="card-body">
                    <canvas id="goalTrendChart" style="min-height:300px;"></canvas>
                </div>
            </div>
        </section>

        <!-- ==================== ANALYTICS SECTION ==================== -->
        <section class="content-section" id="section-analytics">
            <div class="section-header">
                <div>
                    <h1><i class="fas fa-chart-pie"></i> Analytics</h1>
                    <p class="section-subtitle">Deep analysis of your field activities, coverage, and impact</p>
                </div>
                <div class="header-actions">
                    <button class="btn btn-outline btn-sm" onclick="toggleVisitFrequency()" id="visitFreqBtn"><i class="fas fa-school"></i> Visit Frequency</button>
                    <button class="btn btn-outline btn-sm" id="periodCompareBtn" onclick="togglePeriodComparison()"><i class="fas fa-columns"></i> Compare Periods</button>
                    <select id="analyticsRange" class="filter-select" onchange="renderAnalytics()">
                        <option value="all">All Time</option>
                        <option value="month" selected>This Month</option>
                        <option value="quarter">This Quarter</option>
                        <option value="year">This Year</option>
                    </select>
                </div>
            </div>

            <!-- Period Comparison Panel -->
            <div class="period-compare-panel" id="periodComparePanel" style="display:none;"></div>

            <!-- Visit Frequency Panel -->
            <div class="card visit-freq-panel" id="visitFreqPanel" style="display:none;">
                <div class="card-header">
                    <h3><i class="fas fa-school"></i> School Visit Frequency</h3>
                    <button class="btn btn-ghost btn-sm" onclick="toggleVisitFrequency()"><i class="fas fa-times"></i></button>
                </div>
                <div class="card-body" id="visitFreqBody" style="max-height:500px;overflow-y:auto;"></div>
            </div>

            <!-- Smart Insights -->
            <div class="analytics-insights" id="analyticsInsightsPanel"></div>

            <!-- Key Metrics Row -->
            <div class="analytics-kpi-grid" id="analyticsKpiGrid"></div>

            <!-- Charts Grid -->
            <div class="analytics-charts-grid">
                <div class="card">
                    <div class="card-header"><h3><i class="fas fa-chart-doughnut"></i> Visit Purpose Breakdown</h3></div>
                    <div class="card-body"><canvas id="chartVisitPurpose" style="max-height:320px;"></canvas></div>
                </div>
                <div class="card">
                    <div class="card-header"><h3><i class="fas fa-chart-bar"></i> School Coverage</h3></div>
                    <div class="card-body"><canvas id="chartSchoolCoverage" style="max-height:320px;"></canvas></div>
                </div>
                <div class="card">
                    <div class="card-header"><h3><i class="fas fa-star-half-alt"></i> Average Observation Ratings</h3></div>
                    <div class="card-body"><canvas id="chartObsRatings" style="max-height:320px;"></canvas></div>
                </div>
                <div class="card">
                    <div class="card-header"><h3><i class="fas fa-book"></i> Subject Distribution</h3></div>
                    <div class="card-body"><canvas id="chartSubjectDist" style="max-height:320px;"></canvas></div>
                </div>
                <div class="card">
                    <div class="card-header"><h3><i class="fas fa-users"></i> Training â€” Teachers Reached</h3></div>
                    <div class="card-body"><canvas id="chartTrainingImpact" style="max-height:320px;"></canvas></div>
                </div>
                <div class="card">
                    <div class="card-header"><h3><i class="fas fa-calendar-check"></i> Weekly Activity Heatmap</h3></div>
                    <div class="card-body"><canvas id="chartWeeklyHeatmap" style="max-height:320px;"></canvas></div>
                </div>
            </div>

            <!-- Activity Timeline -->
            <div class="card" style="margin-top:20px;">
                <div class="card-header">
                    <h3><i class="fas fa-stream"></i> Activity Timeline</h3>
                    <span class="text-muted" id="timelineCount"></span>
                </div>
                <div class="card-body" id="activityTimeline" style="max-height:500px;overflow-y:auto;"></div>
            </div>
        </section>

        <!-- ==================== FOLLOW-UPS SECTION ==================== -->
        <section class="content-section" id="section-followups">
            <div class="section-header">
                <div>
                    <h1><i class="fas fa-tasks"></i> Follow-up Tracker</h1>
                    <p class="section-subtitle">Track pending follow-ups from school visits and observations</p>
                </div>
                <div class="header-actions">
                    <select id="followupFilter" class="filter-select" onchange="_pageState.followups=1;renderFollowups()">
                        <option value="pending">Pending</option>
                        <option value="done">Completed</option>
                        <option value="all">All</option>
                    </select>
                </div>
            </div>
            <div class="followup-stats" id="followupStats"></div>
            <div id="followupsContainer" class="followups-list"></div>
        </section>

        <!-- ==================== IDEA TRACKER SECTION ==================== -->
        <section class="content-section" id="section-ideas">
            <div class="section-header">
                <div>
                    <h1><i class="fas fa-lightbulb"></i> Idea Tracker</h1>
                    <p class="section-subtitle">Capture, organize & nurture your best ideas âœ¨</p>
                </div>
                <div class="header-actions">
                    <button class="btn btn-primary" onclick="openIdeaModal()">
                        <i class="fas fa-plus"></i> New Idea
                    </button>
                </div>
            </div>

            <!-- Idea Stats -->
            <div class="idea-stats-row" id="ideaStats"></div>

            <!-- View Toggle & Filters -->
            <div class="idea-toolbar">
                <div class="idea-view-toggle">
                    <button class="view-btn active" data-view="board" onclick="setIdeaView('board')">
                        <i class="fas fa-columns"></i> Board
                    </button>
                    <button class="view-btn" data-view="grid" onclick="setIdeaView('grid')">
                        <i class="fas fa-th"></i> Grid
                    </button>
                    <button class="view-btn" data-view="list" onclick="setIdeaView('list')">
                        <i class="fas fa-list"></i> List
                    </button>
                </div>
                <div class="idea-filters">
                    <select id="ideaCategoryFilter" class="filter-select" onchange="_pageState.ideas=1;renderIdeas()">
                        <option value="all">All Categories</option>
                        <option value="Teaching">ðŸŽ“ Teaching</option>
                        <option value="Activity">ðŸŽ¨ Activity</option>
                        <option value="Training">ðŸ“‹ Training</option>
                        <option value="Resource">ðŸ“š Resource</option>
                        <option value="Community">ðŸ¤ Community</option>
                        <option value="Tech">ðŸ’» Tech</option>
                        <option value="Other">ðŸ’¡ Other</option>
                    </select>
                    <input type="text" id="ideaSearchInput" class="filter-input" placeholder="Search ideas..." oninput="_pageState.ideas=1;renderIdeas()">
                </div>
            </div>

            <!-- Idea Board / Grid / List Container -->
            <div id="ideasContainer"></div>
        </section>

        <!-- ==================== SCHOOL PROFILES SECTION ==================== -->
        <section class="content-section" id="section-schools">
            <div class="section-header">
                <div>
                    <h1><i class="fas fa-map-marker-alt"></i> School Profiles</h1>
                    <p class="section-subtitle">Complete history of every school you work with</p>
                </div>
                <div class="header-actions">
                    <button class="btn btn-outline" onclick="triggerSchoolProfileImport()" title="Import school profiles from DMT Excel">
                        <i class="fas fa-file-excel"></i> Import from Excel
                    </button>
                    <button class="btn btn-danger-outline" onclick="openBulkDeleteSchools()" title="Delete multiple schools">
                        <i class="fas fa-trash-alt"></i> Delete Schools
                    </button>
                    <input type="file" id="schoolProfileImportFile" accept=".xlsx,.xls,.csv" style="display:none" onchange="loadSchoolProfileImportPreview(event)">
                    <input type="text" id="schoolSearchInput" class="filter-input" placeholder="Search schools..." oninput="_pageState.schools=1;renderSchoolProfiles()">
                </div>
            </div>
            <div class="school-summary-stats" id="schoolSummaryStats"></div>
            <div id="schoolProfilesContainer"></div>
            <!-- School Detail View (hidden by default) -->
            <div id="schoolDetailView" style="display:none;"></div>
        </section>

        <!-- ==================== TEACHER GROWTH SECTION ==================== -->
        <section class="content-section" id="section-teachers">
            <div class="section-header">
                <div>
                    <h1><i class="fas fa-user-graduate"></i> Teacher Growth Tracker</h1>
                    <p class="section-subtitle">Track every teacher's progress across observations over time</p>
                </div>
                <div class="header-actions">
                    <select id="teacherSortSelect" class="filter-select" onchange="_pageState.teacherGrowth=1;renderTeacherGrowth()">
                        <option value="observations">Most Observed</option>
                        <option value="name">Name A-Z</option>
                        <option value="engagement-low">Low Engagement First</option>
                        <option value="engagement-high">High Engagement First</option>
                        <option value="recent">Recently Observed</option>
                        <option value="stale">Needs Visit (Oldest First)</option>
                    </select>
                    <input type="text" id="teacherGrowthSearch" class="filter-input" placeholder="Search teachers..." oninput="_pageState.teacherGrowth=1;renderTeacherGrowth()">
                </div>
            </div>
            <div class="tg-summary" id="tgSummary"></div>
            <div id="teacherGrowthContainer"></div>
        </section>

        <!-- ==================== MARAI TRACKING SECTION ==================== -->
        <section class="content-section" id="section-marai">
            <div class="section-header">
                <div>
                    <h1><i class="fas fa-route"></i> MARAI Teacher Tracking</h1>
                    <p class="section-subtitle">Track teacher development: Motivation â†’ Awareness â†’ Readiness â†’ Action â†’ Internalization</p>
                </div>
                <div class="header-actions">
                    <input type="text" id="maraiSearchInput" class="filter-input" placeholder="Search teacher / school..." oninput="_pageState.marai=1;renderMaraiTracking()">
                </div>
            </div>
            <!-- Smart Filter Bar -->
            <div class="marai-filter-bar">
                <div class="marai-filter-row">
                    <select id="maraiStageFilter" class="filter-select" onchange="_pageState.marai=1;renderMaraiTracking()">
                        <option value="all">ðŸ·ï¸ All Stages</option>
                        <option value="motivation">ðŸ”¥ Motivation</option>
                        <option value="awareness">ðŸ‘ï¸ Awareness</option>
                        <option value="readiness">ðŸŽ¯ Readiness</option>
                        <option value="action">ðŸš€ Action</option>
                        <option value="internalization">ðŸ’Ž Internalization</option>
                        <option value="untracked">ðŸ“‹ Untracked</option>
                    </select>
                    <select id="maraiSchoolFilter" class="filter-select" onchange="_pageState.marai=1;renderMaraiTracking()">
                        <option value="all">ðŸ« All Schools</option>
                    </select>
                    <select id="maraiBlockFilter" class="filter-select" onchange="_pageState.marai=1;renderMaraiTracking()">
                        <option value="all">ðŸ“ All Blocks</option>
                    </select>
                    <select id="maraiSortSelect" class="filter-select" onchange="_pageState.marai=1;renderMaraiTracking()">
                        <option value="recent">ðŸ•’ Recent First</option>
                        <option value="name">ðŸ”¤ Name A-Z</option>
                        <option value="stage-asc">ðŸ“ˆ Stage Lowâ†’High</option>
                        <option value="stage-desc">ðŸ“‰ Stage Highâ†’Low</option>
                        <option value="most-observed">ðŸ‘ï¸ Most Observed</option>
                        <option value="least-observed">ðŸ“‹ Least Observed</option>
                        <option value="overdue">â° Needs Visit First</option>
                    </select>
                </div>
                <div class="marai-smart-filters" id="maraiSmartFilters">
                    <!-- Dynamically populated smart filter chips -->
                </div>
            </div>
            <div class="marai-stats-grid" id="maraiStats"></div>
            <div class="marai-framework-info">
                <div class="marai-info-title"><i class="fas fa-info-circle"></i> MARAI Framework</div>
                <div class="marai-stages-legend">
                    <span class="marai-legend-item" style="--legend-color:#f59e0b">ðŸ”¥ <strong>M</strong>otivation</span>
                    <span class="marai-legend-item" style="--legend-color:#3b82f6">ðŸ‘ï¸ <strong>A</strong>wareness</span>
                    <span class="marai-legend-item" style="--legend-color:#8b5cf6">ðŸŽ¯ <strong>R</strong>eadiness</span>
                    <span class="marai-legend-item" style="--legend-color:#10b981">ðŸš€ <strong>A</strong>ction</span>
                    <span class="marai-legend-item" style="--legend-color:#ec4899">ðŸ’Ž <strong>I</strong>nternalization</span>
                </div>
            </div>
            <div id="maraiContainer"></div>
        </section>

        <!-- MARAI Record Modal -->
        <div class="modal-overlay" id="maraiRecordModal">
            <div class="modal marai-record-modal" style="max-width:540px">
                <div class="modal-header marai-modal-header">
                    <h2 id="maraiModalTitle"><i class="fas fa-route"></i> Update MARAI Stage</h2>
                    <button class="modal-close" onclick="closeModal('maraiRecordModal')">&times;</button>
                </div>
                <!-- Live stage preview -->
                <div class="marai-stage-preview" id="maraiStagePreview">
                    <div class="marai-preview-dots" id="maraiPreviewDots"></div>
                </div>
                <form id="maraiRecordForm" onsubmit="saveMaraiRecord(event)">
                    <div class="marai-modal-body">
                        <div class="form-group marai-fg">
                            <label><i class="fas fa-user-tie"></i> Teacher Name</label>
                            <input type="text" id="maraiTeacherName" required placeholder="Enter teacher's full name" autocomplete="off">
                        </div>
                        <div class="form-group marai-fg">
                            <label><i class="fas fa-school"></i> School</label>
                            <input type="text" id="maraiSchool" placeholder="School name" autocomplete="off">
                        </div>
                        <div class="form-row marai-form-row">
                            <div class="form-group marai-fg">
                                <label><i class="fas fa-layer-group"></i> MARAI Stage</label>
                                <select id="maraiStage" required onchange="updateMaraiStagePreview()">
                                    <option value="motivation">ðŸ”¥ Motivation</option>
                                    <option value="awareness">ðŸ‘ï¸ Awareness</option>
                                    <option value="readiness">ðŸŽ¯ Readiness</option>
                                    <option value="action">ðŸš€ Action</option>
                                    <option value="internalization">ðŸ’Ž Internalization</option>
                                </select>
                            </div>
                            <div class="form-group marai-fg">
                                <label><i class="fas fa-calendar-alt"></i> Date</label>
                                <input type="date" id="maraiDate" required>
                            </div>
                        </div>
                        <div class="form-group marai-fg">
                            <label><i class="fas fa-sticky-note"></i> Notes / Evidence</label>
                            <textarea id="maraiNotes" rows="4" placeholder="What evidence shows this stage? What was observed?"></textarea>
                        </div>
                    </div>
                    <div class="marai-modal-footer">
                        <button type="button" class="btn btn-outline marai-cancel-btn" onclick="closeModal('maraiRecordModal')">Cancel</button>
                        <button type="submit" class="btn marai-save-btn"><i class="fas fa-save"></i> Save Record</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- MARAI Intervention Plan Modal -->
        <div class="modal-overlay" id="maraiPlanModal">
            <div class="modal marai-plan-modal" style="max-width:780px;max-height:90vh">
                <div class="modal-header">
                    <h2><i class="fas fa-clipboard-list"></i> Intervention Plan</h2>
                    <button class="modal-close" onclick="closeModal('maraiPlanModal')">&times;</button>
                </div>
                <div class="modal-body marai-plan-scroll" id="maraiPlanBody">
                    <!-- Dynamically populated -->
                </div>
            </div>
        </div>

        <!-- ==================== SCHOOL-BASED WORK SECTION ==================== -->
        <section class="content-section" id="section-schoolwork">
            <div class="section-header">
                <div>
                    <h1><i class="fas fa-chalkboard"></i> School-Based Work</h1>
                    <p class="section-subtitle">Track Assembly, Print-Rich Environment, Library, Creative Writing & Bal Shodh Mela</p>
                </div>
                <div class="header-actions">
                    <button class="btn btn-primary" onclick="openSchoolWorkModal()">
                        <i class="fas fa-plus"></i> Log Activity
                    </button>
                    <select id="schoolWorkTypeFilter" class="filter-select" onchange="_pageState.schoolWork=1;renderSchoolWork()">
                        <option value="all">All Activities</option>
                        <option value="assembly">ðŸŽ¤ Assembly</option>
                        <option value="print-rich">ðŸ–¼ï¸ Print Rich</option>
                        <option value="library">ðŸ“š Library</option>
                        <option value="creative-writing">âœï¸ Creative Writing</option>
                        <option value="bal-shodh-mela">ðŸ”¬ Bal Shodh Mela</option>
                        <option value="other">ðŸ“Œ Other</option>
                    </select>
                    <input type="text" id="schoolWorkSearchInput" class="filter-input" placeholder="Search school / activity..." oninput="_pageState.schoolWork=1;renderSchoolWork()">
                </div>
            </div>
            <div class="sw-stats-grid" id="schoolWorkStats"></div>
            <div id="schoolWorkContainer"></div>
        </section>

        <!-- School Work Modal -->
        <div class="modal-overlay" id="schoolWorkModal">
            <div class="modal sw-modal" style="max-width:620px">
                <div class="modal-header sw-modal-header">
                    <h2 id="schoolWorkModalTitle"><i class="fas fa-chalkboard"></i> Log School Work</h2>
                    <button class="modal-close" onclick="closeModal('schoolWorkModal')">&times;</button>
                </div>
                <form id="schoolWorkForm" onsubmit="saveSchoolWork(event)">
                    <div class="sw-modal-body">
                        <input type="hidden" id="schoolWorkId">
                        <div class="form-row sw-form-row">
                            <div class="form-group sw-fg">
                                <label><i class="fas fa-tag"></i> Activity Type</label>
                                <select id="schoolWorkType" required>
                                    <option value="assembly">ðŸŽ¤ Assembly</option>
                                    <option value="print-rich">ðŸ–¼ï¸ Print Rich Environment</option>
                                    <option value="library">ðŸ“š Library</option>
                                    <option value="creative-writing">âœï¸ Creative Writing</option>
                                    <option value="bal-shodh-mela">ðŸ”¬ Bal Shodh Mela</option>
                                    <option value="other">ðŸ“Œ Other Activity</option>
                                </select>
                            </div>
                            <div class="form-group sw-fg">
                                <label><i class="fas fa-heading"></i> Title</label>
                                <input type="text" id="schoolWorkTitle" placeholder="Activity title / topic">
                            </div>
                        </div>
                        <div class="form-row sw-form-row">
                            <div class="form-group sw-fg">
                                <label><i class="fas fa-school"></i> School</label>
                                <input type="text" id="schoolWorkSchool" required placeholder="School name" list="schoolWorkSchoolList">
                                <datalist id="schoolWorkSchoolList"></datalist>
                            </div>
                            <div class="form-group sw-fg">
                                <label><i class="fas fa-map-marker-alt"></i> Block</label>
                                <input type="text" id="schoolWorkBlock" placeholder="Block name">
                            </div>
                        </div>
                        <div class="form-row sw-form-row">
                            <div class="form-group sw-fg">
                                <label><i class="fas fa-calendar-alt"></i> Date</label>
                                <input type="date" id="schoolWorkDate" required>
                            </div>
                            <div class="form-group sw-fg">
                                <label><i class="fas fa-flag"></i> Status</label>
                                <select id="schoolWorkStatus">
                                    <option value="completed">âœ… Completed</option>
                                    <option value="in-progress">ðŸ”„ In Progress</option>
                                    <option value="planned">ðŸ“‹ Planned</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row sw-form-row">
                            <div class="form-group sw-fg">
                                <label><i class="fas fa-users"></i> Participants Count</label>
                                <input type="number" id="schoolWorkParticipants" placeholder="Number of students" min="0">
                            </div>
                            <div class="form-group sw-fg">
                                <label><i class="fas fa-camera"></i> Photos Taken</label>
                                <input type="number" id="schoolWorkPhotos" placeholder="0" min="0">
                            </div>
                        </div>
                        <div class="form-group sw-fg sw-teachers-group">
                            <label><i class="fas fa-chalkboard-teacher"></i> Assigned Teachers</label>
                            <div class="sw-teachers-input-wrap">
                                <input type="text" id="schoolWorkTeacherInput" placeholder="Type teacher name & press Enter" list="schoolWorkTeacherList" onkeydown="handleSwTeacherKeydown(event)">
                                <datalist id="schoolWorkTeacherList"></datalist>
                                <button type="button" class="sw-teacher-add-btn" onclick="addSwTeacher()" title="Add teacher"><i class="fas fa-plus"></i></button>
                            </div>
                            <div class="sw-teacher-tags" id="schoolWorkTeacherTags"></div>
                        </div>
                        <div class="form-group sw-fg">
                            <label><i class="fas fa-align-left"></i> Description</label>
                            <textarea id="schoolWorkDescription" rows="2" placeholder="What was done? Describe the activity..."></textarea>
                        </div>
                        <div class="form-group sw-fg">
                            <label><i class="fas fa-eye"></i> Observations</label>
                            <textarea id="schoolWorkObservations" rows="2" placeholder="What did you observe? Student engagement, quality..."></textarea>
                        </div>
                        <div class="form-group sw-fg">
                            <label><i class="fas fa-check-circle"></i> Outcome / Impact</label>
                            <input type="text" id="schoolWorkOutcome" placeholder="Key outcome or impact noted">
                        </div>
                    </div>
                    <div class="sw-modal-footer">
                        <button type="button" class="btn btn-outline sw-cancel-btn" onclick="closeModal('schoolWorkModal')">Cancel</button>
                        <button type="submit" class="btn sw-save-btn"><i class="fas fa-save"></i> Save Activity</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- ==================== VISIT PLAN SECTION ==================== -->
        <section class="content-section" id="section-visitplan">
            <div class="section-header">
                <div>
                    <h1><i class="fas fa-clipboard-check"></i> Visit Plan vs Execution</h1>
                    <p class="section-subtitle">Link your Excel file once â€” all data stays in the app automatically</p>
                </div>
                <div class="header-actions">
                    <button class="btn btn-primary" onclick="openVisitPlanModal()">
                        <i class="fas fa-plus"></i> Add Entry
                    </button>
                    <button class="btn btn-outline vp-link-btn" onclick="vpLinkExcel()" id="vpLinkBtn">
                        <i class="fas fa-link"></i> Link Excel
                    </button>
                    <button class="btn btn-outline" onclick="exportVisitPlanExcel()" title="Download as Excel">
                        <i class="fas fa-download"></i>
                    </button>
                </div>
                <div class="vp-linked-status" id="vpLinkedStatus" style="display:none">
                    <i class="fas fa-plug"></i>
                    <span id="vpLinkedFileName">Not linked</span>
                    <span class="vp-link-mode" id="vpLinkMode">Synced</span>
                    <button class="vp-unlink-btn" onclick="vpUnlinkExcel()" title="Unlink"><i class="fas fa-times"></i></button>
                    <span class="vp-autosave-dot" id="vpAutoSaveDot" title="Data saved in app"></span>
                </div>
            </div>
            <!-- Filters -->
            <div class="vp-filter-bar">
                <div class="vp-filter-row">
                    <select id="vpDomainFilter" class="filter-select" onchange="_pageState.visitplan=1;renderVisitPlan()">
                        <option value="all">ðŸ“‚ All Domains</option>
                    </select>
                    <select id="vpStakeholderFilter" class="filter-select" onchange="_pageState.visitplan=1;renderVisitPlan()">
                        <option value="all">ðŸ‘¥ All Stakeholders</option>
                    </select>
                    <select id="vpClusterFilter" class="filter-select" onchange="_pageState.visitplan=1;renderVisitPlan()">
                        <option value="all">ðŸ“ All Clusters</option>
                    </select>
                    <select id="vpMonthFilter" class="filter-select" onchange="_pageState.visitplan=1;renderVisitPlan()">
                        <option value="all">ðŸ“… All Months</option>
                    </select>
                    <select id="vpStatusFilter" class="filter-select" onchange="_pageState.visitplan=1;renderVisitPlan()">
                        <option value="all">ðŸ“‹ All Status</option>
                        <option value="planned">ðŸ“‹ Planned</option>
                        <option value="executed">âœ… Executed</option>
                        <option value="empty">â¬œ Empty/Unfilled</option>
                    </select>
                    <input type="text" id="vpSearchInput" class="filter-input" placeholder="Search..." oninput="_pageState.visitplan=1;renderVisitPlan()">
                    <button class="btn btn-outline vp-bulk-clear-btn" onclick="vpBulkClear()" id="vpBulkClearBtn" title="Delete filtered entries" style="display:none">
                        <i class="fas fa-trash-alt"></i> <span id="vpBulkClearLabel">Clear</span>
                    </button>
                </div>
            </div>
            <!-- Quick Add Domains -->
            <div class="vp-quick-bar" id="vpQuickBar"></div>
            <!-- Stats -->
            <div class="vp-stats-grid" id="vpStats"></div>
            <!-- Table container -->
            <div class="vp-table-wrap" id="vpContainer"></div>
        </section>

        <!-- Visit Plan Entry Modal -->
        <div class="modal-overlay" id="visitPlanModal">
            <div class="modal vp-modal" style="max-width:680px">
                <div class="modal-header vp-modal-header">
                    <h2 id="vpModalTitle"><i class="fas fa-clipboard-check"></i> Visit Plan Entry</h2>
                    <button class="modal-close" onclick="closeModal('visitPlanModal')">&times;</button>
                </div>
                <form id="vpForm" onsubmit="saveVisitPlanEntry(event)">
                    <div class="vp-modal-body">
                        <input type="hidden" id="vpEntryId">
                        <div class="form-row vp-form-row">
                            <div class="form-group vp-fg">
                                <label><i class="fas fa-calendar-alt"></i> Date</label>
                                <input type="date" id="vpDate" required>
                            </div>
                            <div class="form-group vp-fg">
                                <label><i class="fas fa-clock"></i> Time</label>
                                <select id="vpTime" required>
                                    <option value="First Half">First Half</option>
                                    <option value="Second Half">Second Half</option>
                                    <option value="Evening">Evening</option>
                                    <option value="All Day">All Day</option>
                                    <option value="NA">NA</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row vp-form-row">
                            <div class="form-group vp-fg">
                                <label><i class="fas fa-folder-open"></i> Plan Domain</label>
                                <select id="vpDomain">
                                    <option value="">-- Select --</option>
                                </select>
                            </div>
                            <div class="form-group vp-fg">
                                <label><i class="fas fa-users"></i> Stakeholder Type</label>
                                <select id="vpStakeholder">
                                    <option value="">-- Select --</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row vp-form-row">
                            <div class="form-group vp-fg">
                                <label><i class="fas fa-map-marker-alt"></i> Cluster</label>
                                <select id="vpCluster">
                                    <option value="">-- Select --</option>
                                </select>
                            </div>
                            <div class="form-group vp-fg">
                                <label><i class="fas fa-building"></i> Venue</label>
                                <input type="text" id="vpVenue" placeholder="School / Venue name" list="vpVenueList">
                                <datalist id="vpVenueList"></datalist>
                            </div>
                        </div>
                        <div class="form-row vp-form-row">
                            <div class="form-group vp-fg">
                                <label><i class="fas fa-user"></i> Stakeholder Name</label>
                                <input type="text" id="vpStakeholderName" placeholder="Person name" list="vpStakeholderNameList">
                                <datalist id="vpStakeholderNameList"></datalist>
                            </div>
                            <div class="form-group vp-fg">
                                <label><i class="fas fa-id-badge"></i> Designation</label>
                                <select id="vpDesignation">
                                    <option value="">-- Select --</option>
                                    <option value="Teacher">Teacher</option>
                                    <option value="Head teacher">Head teacher</option>
                                    <option value="CAC">CAC</option>
                                    <option value="PLC">PLC</option>
                                    <option value="ECCE">ECCE</option>
                                    <option value="NA">NA</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group vp-fg">
                            <label><i class="fas fa-bullseye"></i> Broader Plan / Objective</label>
                            <textarea id="vpObjective" rows="2" placeholder="What is the objective of this visit?"></textarea>
                        </div>
                        <div class="form-group vp-fg">
                            <label><i class="fas fa-check-double"></i> Review / Execution Notes</label>
                            <textarea id="vpReview" rows="3" placeholder="What actually happened? Review against intervention plan..."></textarea>
                        </div>
                        <div class="form-row vp-form-row">
                            <div class="form-group vp-fg">
                                <label><i class="fas fa-hashtag"></i> No. of TPs</label>
                                <input type="text" id="vpTPs" placeholder="e.g. 2">
                            </div>
                            <div class="form-group vp-fg">
                                <label><i class="fas fa-user-friends"></i> No. of Stakeholders</label>
                                <input type="text" id="vpStakeholderCount" placeholder="e.g. 5">
                            </div>
                        </div>
                        <div class="form-group vp-fg">
                            <label><i class="fas fa-comment-dots"></i> Teacher Comments</label>
                            <textarea id="vpTeacherComments" rows="2" placeholder="Qualitative comments for teachers..."></textarea>
                        </div>
                        <div class="form-group vp-fg">
                            <label><i class="fas fa-child"></i> Student Engagement Comments</label>
                            <textarea id="vpStudentComments" rows="2" placeholder="Comments on engagement with students..."></textarea>
                        </div>
                        <div class="form-group vp-fg">
                            <label><i class="fas fa-share-square"></i> Report Sharing</label>
                            <input type="text" id="vpReportSharing" placeholder="Report shared with...">
                        </div>
                    </div>
                    <div class="vp-modal-footer">
                        <button type="button" class="btn btn-outline" onclick="closeModal('visitPlanModal')">Cancel</button>
                        <button type="submit" class="btn vp-save-btn"><i class="fas fa-save"></i> Save Entry</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- ==================== REFLECTIONS SECTION ==================== -->
        <section class="content-section" id="section-reflections">
            <div class="section-header">
                <div>
                    <h1><i class="fas fa-journal-whills"></i> Reflections Journal</h1>
                    <p class="section-subtitle">Monthly reflections on your practice and growth</p>
                </div>
                <div class="header-actions">
                    <select id="reflectionMonthFilter" class="filter-select" onchange="_pageState.reflections=1;renderReflections()"></select>
                    <button class="btn btn-primary" onclick="openReflectionModal()">
                        <i class="fas fa-plus"></i> New Reflection
                    </button>
                </div>
            </div>
            <div id="reflectionsContainer"></div>
        </section>

        <!-- ==================== GROWTH FRAMEWORK SECTION ==================== -->
        <section class="content-section" id="section-growth">
            <div class="section-header">
                <div>
                    <h1><i class="fas fa-seedling"></i> Professional Growth Framework</h1>
                    <p class="section-subtitle">Track your developmental journey across 5 dimensions â€” self-assess, set goals &amp; grow</p>
                </div>
                <div class="header-actions">
                    <button class="btn btn-outline" onclick="printGrowthReport()">
                        <i class="fas fa-print"></i> Print
                    </button>
                    <button class="btn btn-outline" onclick="exportGrowthReport()">
                        <i class="fas fa-file-export"></i> Export
                    </button>
                    <button class="btn btn-primary" onclick="openGrowthAssessment()">
                        <i class="fas fa-pen-ruler"></i> Self-Assess
                    </button>
                </div>
            </div>

            <!-- Overall Growth Score -->
            <div class="growth-overview" id="growthOverview"></div>

            <!-- Radar Chart + Journey Insights Row -->
            <div class="growth-chart-row">
                <div class="growth-radar-card">
                    <h3><i class="fas fa-chart-radar"></i> Competency Map</h3>
                    <canvas id="growthRadarChart" width="350" height="350"></canvas>
                </div>
                <div class="growth-journey-card" id="growthJourneyCard"></div>
            </div>

            <!-- Growth Line Chart (Trend Over Time) -->
            <div class="growth-trend-section" id="growthTrendSection" style="display:none;">
                <div class="growth-trend-card">
                    <h3><i class="fas fa-chart-line"></i> Growth Trend Over Time</h3>
                    <canvas id="growthTrendChart" height="200"></canvas>
                </div>
            </div>

            <!-- Dimension Cards -->
            <div class="growth-dimensions" id="growthDimensions"></div>

            <!-- Action Plans -->
            <div class="growth-action-plans-section" id="growthActionPlansSection">
                <div class="growth-action-plans-header">
                    <h3><i class="fas fa-tasks"></i> Growth Action Plans</h3>
                    <button class="btn btn-outline btn-sm" onclick="openGrowthActionPlan()">
                        <i class="fas fa-plus"></i> Add Action
                    </button>
                </div>
                <div id="growthActionPlans"></div>
            </div>

            <!-- Dimension Wise Tips -->
            <div class="growth-tips-section" id="growthTipsSection" style="display:none;">
                <h3><i class="fas fa-lightbulb"></i> Growth Suggestions &amp; Recommended Actions</h3>
                <div id="growthTips" class="growth-tips-grid"></div>
            </div>

            <!-- Growth Timeline -->
            <div class="growth-timeline-section">
                <h3><i class="fas fa-history"></i> Assessment History</h3>
                <div id="growthTimeline"></div>
            </div>
        </section>

        <!-- ==================== CONTACTS SECTION ==================== -->
        <section class="content-section" id="section-contacts">
            <div class="section-header">
                <div>
                    <h1><i class="fas fa-address-book"></i> Contact Directory</h1>
                    <p class="section-subtitle">Key contacts for your field work</p>
                </div>
                <div class="header-actions">
                    <select id="contactRoleFilter" class="filter-select" onchange="_pageState.contacts=1;renderContacts()">
                        <option value="all">All Roles</option>
                        <option value="Head Master">Head Master</option>
                        <option value="Teacher">Teacher</option>
                        <option value="BEO">BEO</option>
                        <option value="DIET Faculty">DIET Faculty</option>
                        <option value="CRP">CRP</option>
                        <option value="Fellow RP">Fellow RP</option>
                        <option value="Mentor">Mentor</option>
                        <option value="Other">Other</option>
                    </select>
                    <input type="text" id="contactSearchInput" class="filter-input" placeholder="Search contacts..." oninput="_pageState.contacts=1;renderContacts()">
                    <button class="btn btn-outline" onclick="extractContactsFromObservations()" title="Extract teacher contacts from imported DMT observations">
                        <i class="fas fa-file-import"></i> Extract from Observations
                    </button>
                    <button class="btn btn-danger-outline" onclick="openBulkDeleteContacts()" title="Delete multiple contacts by filter">
                        <i class="fas fa-trash-alt"></i> Bulk Delete
                    </button>
                    <button class="btn btn-primary" onclick="openContactModal()">
                        <i class="fas fa-plus"></i> Add Contact
                    </button>
                </div>
            </div>
            <div class="contact-stats" id="contactStats"></div>
            <div id="contactsContainer"></div>
        </section>

        <!-- ==================== LIVE SYNC SECTION ==================== -->
        <section class="content-section" id="section-livesync">
            <div class="section-header">
                <div>
                    <h1><i class="fas fa-sync-alt"></i> Live Sync</h1>
                    <p class="section-subtitle">Sync data across devices in real-time â€” every change auto-pushes like WhatsApp Web</p>
                </div>
            </div>

            <!-- Sync Status Banner -->
            <div class="sync-status-banner" id="syncStatusBanner">
                <div class="sync-status-icon" id="syncStatusIcon"><i class="fas fa-unlink"></i></div>
                <div class="sync-status-info">
                    <span class="sync-status-label" id="syncStatusLabel">Not Connected</span>
                    <span class="sync-status-detail" id="syncStatusDetail">Create or join a sync room to start</span>
                </div>
            </div>

            <div class="sync-grid">
                <!-- Create Room Card -->
                <div class="sync-card" id="syncCreateCard">
                    <div class="sync-card-icon" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                        <i class="fas fa-broadcast-tower"></i>
                    </div>
                    <h3>Create Sync Room</h3>
                    <p>Start a room on this device. Every data change will auto-push to all connected devices instantly.</p>
                    <button class="btn btn-primary" onclick="createSyncRoom()" id="btnCreateRoom" style="background:#f59e0b;">
                        <i class="fas fa-plus-circle"></i> Create Room
                    </button>
                </div>

                <!-- Join Room Card -->
                <div class="sync-card" id="syncJoinCard">
                    <div class="sync-card-icon" style="background: linear-gradient(135deg, #3b82f6, #1d4ed8);">
                        <i class="fas fa-sign-in-alt"></i>
                    </div>
                    <h3>Join Sync Room</h3>
                    <p>Enter the room code from another device to connect. Changes will sync automatically in both directions.</p>
                    <div class="sync-join-input">
                        <input type="text" id="syncJoinCode" placeholder="Enter room code" maxlength="20" autocomplete="off" spellcheck="false">
                        <button class="btn btn-primary" onclick="joinSyncRoom()" id="btnJoinRoom" style="background:#3b82f6;">
                            <i class="fas fa-link"></i> Join
                        </button>
                    </div>
                </div>
            </div>

            <!-- Active Room Panel (shown when connected) -->
            <div class="sync-active-panel" id="syncActivePanel" style="display:none;">
                <!-- Room Info + QR Code -->
                <div class="sync-room-info">
                    <div class="sync-room-left">
                        <div class="sync-room-code-display">
                            <span class="sync-room-label">Room Code</span>
                            <span class="sync-room-code" id="syncRoomCodeDisplay">------</span>
                            <button class="btn-icon-sm" onclick="copySyncCode()" title="Copy code"><i class="fas fa-copy"></i></button>
                        </div>
                        <div class="sync-room-meta">
                            <span id="syncRoomRole" class="sync-role-badge"><i class="fas fa-broadcast-tower"></i> Host</span>
                            <span id="syncPeerCount" class="sync-peer-count"><i class="fas fa-users"></i> 0 devices</span>
                            <span id="syncLastSync" class="sync-last-time"><i class="fas fa-clock"></i> â€”</span>
                        </div>
                        <div class="sync-auto-badge">
                            <i class="fas fa-bolt"></i> Auto-sync active â€” every change pushes instantly
                        </div>
                    </div>
                    <div class="sync-room-qr" id="syncQRCode"></div>
                </div>

                <!-- Sync Stats -->
                <div class="sync-stats-section">
                    <div class="sync-stats-grid" id="syncStatsPanel">
                        <div class="sync-stat-item"><span class="sync-stat-val">0</span><span class="sync-stat-label">Changes Synced</span></div>
                        <div class="sync-stat-item"><span class="sync-stat-val">0 B</span><span class="sync-stat-label">Data Transferred</span></div>
                        <div class="sync-stat-item"><span class="sync-stat-val">â€”</span><span class="sync-stat-label">Last Sync</span></div>
                    </div>
                </div>

                <!-- Connected Devices -->
                <div class="sync-devices-section">
                    <h4><i class="fas fa-laptop"></i> Connected Devices</h4>
                    <div id="syncDevicesList" class="sync-devices-list">
                        <div class="sync-no-devices"><i class="fas fa-satellite-dish"></i> Waiting for devices to connect...</div>
                    </div>
                </div>

                <!-- Sync Actions -->
                <div class="sync-action-bar">
                    <button class="btn btn-primary" onclick="sendSyncData()" id="btnSendSync" title="Manually push all data to connected devices">
                        <i class="fas fa-upload"></i> Push All Data
                    </button>
                    <button class="btn btn-outline" onclick="requestSyncData()" id="btnRequestSync" title="Pull all data from the connected device">
                        <i class="fas fa-download"></i> Pull All Data
                    </button>
                    <button class="btn btn-danger" onclick="disconnectSync()" id="btnDisconnect">
                        <i class="fas fa-times-circle"></i> Disconnect
                    </button>
                </div>

                <!-- Sync Log -->
                <div class="sync-log-section">
                    <h4><i class="fas fa-history"></i> Sync Activity</h4>
                    <div id="syncLog" class="sync-log">
                        <div class="sync-log-empty">No activity yet</div>
                    </div>
                </div>
            </div>

            <!-- Sync Settings -->
            <div class="sync-settings-card">
                <h4><i class="fas fa-cog"></i> Sync Settings</h4>
                <div id="syncSettingsPanel"></div>
            </div>

            <!-- How it Works -->
            <div class="sync-how-it-works" id="syncHowItWorks">
                <h4><i class="fas fa-question-circle"></i> How Live Sync Works</h4>
                <div class="sync-steps">
                    <div class="sync-step">
                        <div class="sync-step-num">1</div>
                        <div class="sync-step-text">
                            <strong>Create a Room</strong>
                            <span>Open the dashboard on your primary device and create a sync room. You'll get a unique code.</span>
                        </div>
                    </div>
                    <div class="sync-step">
                        <div class="sync-step-num">2</div>
                        <div class="sync-step-text">
                            <strong>Join from Other Devices</strong>
                            <span>Open the dashboard on your phone/laptop and enter the room code to connect.</span>
                        </div>
                    </div>
                    <div class="sync-step">
                        <div class="sync-step-num">3</div>
                        <div class="sync-step-text">
                            <strong>Every Change Auto-Syncs</strong>
                            <span>Add a visit, edit a note, or save training â€” it auto-pushes to all connected devices in real-time. No manual sync needed!</span>
                        </div>
                    </div>
                    <div class="sync-step">
                        <div class="sync-step-num">4</div>
                        <div class="sync-step-text">
                            <strong>Auto-Reconnect</strong>
                            <span>If you refresh the page or lose connection, it automatically reconnects using the saved room code â€” like WhatsApp Web.</span>
                        </div>
                    </div>
                </div>
                <div class="sync-info-note">
                    <i class="fas fa-shield-alt"></i>
                    <span>Data travels directly between your devices (peer-to-peer). Nothing is stored on any server. All data is encrypted in transit.</span>
                </div>
                <div class="sync-info-note" style="margin-top: 10px;">
                    <i class="fas fa-magic"></i>
                    <span><strong>Smart Merge:</strong> When both devices have changes, records are intelligently merged by ID â€” no data loss. Newer records take priority.</span>
                </div>
            </div>
        </section>

        <!-- ==================== MONTHLY WORK LOG SECTION ==================== -->
        <section class="content-section" id="section-worklog">
            <div class="section-header">
                <div>
                    <h1><i class="fas fa-clipboard-list"></i> Monthly Work Log</h1>
                    <p class="section-subtitle">Daily field diary â€” auto-generated from your data</p>
                </div>
                <div class="header-actions">
                    <select id="worklogMonth" class="filter-select" onchange="renderWorkLog()"></select>
                    <button class="btn btn-outline" onclick="printWorkLog()">
                        <i class="fas fa-print"></i> Print
                    </button>
                    <button class="btn btn-primary" onclick="addWorkLogEntry()">
                        <i class="fas fa-plus"></i> Add Entry
                    </button>
                </div>
            </div>
            <!-- Work Log Stats -->
            <div class="worklog-stats" id="worklogStats"></div>
            <!-- Work Log Table -->
            <div class="worklog-table-container" id="worklogContainer"></div>
        </section>

        <!-- ==================== MEETING TRACKER SECTION ==================== -->
        <section class="content-section" id="section-meetings">
            <div class="section-header">
                <div>
                    <h1><i class="fas fa-handshake"></i> Meeting Tracker</h1>
                    <p class="section-subtitle">Track BRC, cluster, district, and other meetings with action items</p>
                </div>
                <div class="header-actions">
                    <select id="meetingFilter" class="filter-select" onchange="_pageState.meetings=1;renderMeetings()">
                        <option value="all">All Types</option>
                        <option value="BRC Meeting">BRC Meeting</option>
                        <option value="Cluster Meeting">Cluster Meeting</option>
                        <option value="District Meeting">District Meeting</option>
                        <option value="SDMC Meeting">SDMC Meeting</option>
                        <option value="Parent-Teacher Meeting">Parent-Teacher</option>
                        <option value="Convergence Meeting">Convergence</option>
                        <option value="Review Meeting">Review Meeting</option>
                        <option value="Other">Other</option>
                    </select>
                    <button class="btn btn-primary" onclick="openMeetingModal()">
                        <i class="fas fa-plus"></i> Add Meeting
                    </button>
                </div>
            </div>
            <!-- Meeting Stats -->
            <div class="meeting-stats" id="meetingStats"></div>
            <!-- Meeting List -->
            <div class="meeting-list" id="meetingList"></div>
        </section>

        <!-- ==================== BACKUP & RESTORE SECTION ==================== -->
        <section class="content-section" id="section-backup">
            <div class="section-header">
                <div>
                    <h1><i class="fas fa-shield-alt"></i> Data & Security</h1>
                    <p class="section-subtitle">Data auto-saves encrypted to your linked file &amp; browser â€” always protected</p>
                </div>
            </div>
            <div class="backup-grid">
                <!-- Encrypted File Storage â€” Primary -->
                <div class="backup-card backup-encrypted" style="grid-column: 1 / -1;">
                    <!-- Top: Icon + Title -->
                    <div class="enc-card-top">
                        <div class="enc-card-icon">
                            <i class="fas fa-lock"></i>
                        </div>
                        <div class="enc-card-title">
                            <h3><i class="fas fa-lock"></i> Encrypted File Storage</h3>
                            <p>AES-256 encrypted &bull; Auto-saves on every change &bull; Direct file read/write</p>
                        </div>
                    </div>

                    <!-- Status Area -->
                    <div class="enc-card-status" id="encryptedFileStatus"></div>

                    <!-- Actions Row -->
                    <div class="enc-card-actions">
                        <div class="enc-action-group">
                            <span class="enc-action-label"><i class="fas fa-file-arrow-down"></i> File</span>
                            <div class="enc-action-buttons">
                                <button class="btn btn-primary enc-btn-download" onclick="saveEncryptedFile()" id="btnSaveEncrypted">
                                    <i class="fas fa-download"></i> Download .apf
                                </button>
                                <label class="btn btn-outline enc-btn-upload">
                                    <i class="fas fa-upload"></i> Load .apf
                                    <input type="file" accept=".apf" onchange="loadEncryptedFile(event)" style="display:none">
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Data Summary -->
                    <div class="enc-card-summary" id="encDataSummary"></div>

                    <!-- Footer Note -->
                    <div class="enc-card-footer">
                        <i class="fas fa-shield-alt"></i>
                        <span>Data is encrypted with AES-256-GCM using PBKDF2 key derivation (100K iterations). Auto-saved to linked file &amp; browser cache.</span>
                        <span id="encUnsavedBadge" class="unsaved-badge" style="display:none;">Saving...</span>
                    </div>
                </div>

                <!-- Google Drive Auto-Backup -->
                <div class="backup-card gdrive-card" style="grid-column: 1 / -1;">
                    <div class="enc-card-top">
                        <div class="enc-card-icon" style="background: linear-gradient(135deg, #4285f4, #1a73e8);">
                            <i class="fab fa-google-drive"></i>
                        </div>
                        <div class="enc-card-title">
                            <h3><i class="fab fa-google-drive"></i> Google Drive Auto-Backup</h3>
                            <p>Automatic encrypted backups to your Google Drive &bull; Free &bull; No API key needed</p>
                        </div>
                        <span class="gdrive-dot" id="gdriveDot"></span>
                    </div>

                    <!-- Connection Status -->
                    <div class="gdrive-status" id="gdriveStatus">
                        <i class="fas fa-cloud"></i>
                        <div>
                            <strong>Not Connected</strong>
                            <span>Connect to auto-backup your data to Google Drive</span>
                        </div>
                    </div>

                    <!-- Connect Area -->
                    <div class="gdrive-connect-area" id="gdriveConnectArea">
                        <div class="gdrive-url-row">
                            <input type="url" id="gdriveScriptURL" placeholder="Paste your Google Apps Script URL here" class="gdrive-url-input" autocomplete="off" spellcheck="false">
                            <button class="btn btn-primary" id="gdriveConnectBtn" onclick="connectGoogleDrive()" style="background:#4285f4;">
                                <i class="fas fa-plug"></i> Connect
                            </button>
                        </div>
                        <button class="gdrive-setup-toggle" onclick="toggleGdriveSetup()">
                            <i class="fas fa-question-circle"></i> How to set up Google Drive backup (2 min setup)
                        </button>

                        <!-- Setup Guide (collapsed) -->
                        <div class="gdrive-setup-guide" id="gdriveSetupGuide" style="display:none;">
                            <div class="gdrive-setup-steps">
                                <div class="gdrive-step">
                                    <div class="gdrive-step-num">1</div>
                                    <div>
                                        <strong>Open Google Apps Script</strong>
                                        <span>Go to <a href="https://script.google.com/home" target="_blank" rel="noopener" style="color:#4285f4;">script.google.com</a> and click <b>New Project</b></span>
                                    </div>
                                </div>
                                <div class="gdrive-step">
                                    <div class="gdrive-step-num">2</div>
                                    <div>
                                        <strong>Paste this code</strong>
                                        <span>Delete the existing code and paste the code below, then press <b>Ctrl+S</b> to save</span>
                                    </div>
                                </div>
                            </div>

                            <div class="gdrive-code-block">
                                <div class="gdrive-code-header">
                                    <span>Google Apps Script Code</span>
                                    <button class="gdrive-copy-btn" onclick="copyAppsScriptCode()"><i class="fas fa-copy"></i> Copy</button>
                                </div>
                                <pre id="gdriveScriptCode">function doPost(e) {
  var content = JSON.parse(e.postData.contents);
  var action = content.action;

  if (action === 'ping') {
    return send({status:'ok', app:'APF Dashboard Backup'});
  }

  if (action === 'backup') {
    var folder = getOrCreateFolder();
    var files = folder.getFilesByName('APF_Backup.apf');
    if (files.hasNext()) {
      files.next().setContent(content.data);
    } else {
      folder.createFile('APF_Backup.apf', content.data, 'text/plain');
    }
    return send({success:true, timestamp:content.timestamp});
  }

  if (action === 'restore') {
    var folder = getOrCreateFolder();
    var files = folder.getFilesByName('APF_Backup.apf');
    if (files.hasNext()) {
      return send({data:files.next().getBlob().getDataAsString()});
    }
    return send({error:'No backup found'});
  }

  if (action === 'info') {
    var folder = getOrCreateFolder();
    var files = folder.getFilesByName('APF_Backup.apf');
    if (files.hasNext()) {
      var f = files.next();
      return send({exists:true, size:f.getSize(),
        updated:f.getLastUpdated().toISOString()});
    }
    return send({exists:false});
  }

  return send({error:'Unknown action'});
}

function doGet(e) {
  return ContentService.createTextOutput(
    JSON.stringify({status:'ok', app:'APF Dashboard Backup'})
  ).setMimeType(ContentService.MimeType.JSON);
}

function send(obj) {
  return ContentService.createTextOutput(
    JSON.stringify(obj)
  ).setMimeType(ContentService.MimeType.JSON);
}

function getOrCreateFolder() {
  var folders = DriveApp.getFoldersByName('APF Dashboard Backups');
  if (folders.hasNext()) return folders.next();
  return DriveApp.createFolder('APF Dashboard Backups');
}</pre>
                            </div>

                            <div class="gdrive-setup-steps">
                                <div class="gdrive-step">
                                    <div class="gdrive-step-num">3</div>
                                    <div>
                                        <strong>Deploy as Web App</strong>
                                        <span>Click <b>Deploy â†’ New deployment</b> â†’ Select type: <b>Web app</b> â†’ Set "Who has access" to <b>Anyone</b> â†’ Click <b>Deploy</b> â†’ Authorize when prompted</span>
                                    </div>
                                </div>
                                <div class="gdrive-step">
                                    <div class="gdrive-step-num">4</div>
                                    <div>
                                        <strong>Copy the URL</strong>
                                        <span>Copy the <b>Web app URL</b> (starts with https://script.google.com/...) and paste it above</span>
                                    </div>
                                </div>
                            </div>

                            <div class="gdrive-security-note">
                                <i class="fas fa-shield-alt"></i>
                                <span>Your data is AES-256 encrypted <b>before</b> leaving your browser. The script only stores encrypted data â€” it can never read your actual data. You own the script, you can inspect and delete it anytime.</span>
                            </div>
                        </div>
                    </div>

                    <!-- Connected Actions -->
                    <div class="gdrive-connected-actions" id="gdriveActions" style="display:none;">
                        <div class="gdrive-info" id="gdriveInfo"></div>
                        <div class="gdrive-buttons">
                            <button class="btn btn-primary" id="gdriveBackupBtn" onclick="gdriveBackupNow()" style="background:#4285f4;">
                                <i class="fas fa-cloud-upload-alt"></i> Backup Now
                            </button>
                            <button class="btn btn-outline" id="gdriveRestoreBtn" onclick="gdriveRestoreNow()">
                                <i class="fas fa-cloud-download-alt"></i> Restore from Drive
                            </button>
                        </div>
                        <div class="gdrive-auto-row">
                            <label class="gdrive-auto-label" for="gdriveAutoToggle">
                                <i class="fas fa-sync-alt"></i> Auto-backup on every change
                            </label>
                            <label class="gdrive-toggle-switch">
                                <input type="checkbox" id="gdriveAutoToggle" onchange="toggleGdriveAuto(this.checked)" checked>
                                <span class="gdrive-toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <!-- Disconnect -->
                    <div class="gdrive-disconnect-area" id="gdriveDisconnectArea" style="display:none;">
                        <button class="gdrive-disconnect-btn" onclick="disconnectGoogleDrive()">
                            <i class="fas fa-unlink"></i> Disconnect Google Drive
                        </button>
                    </div>
                </div>

                <!-- Bottom Cards Row -->
                <div class="backup-bottom-row">
                    <div class="backup-card backup-excel">
                        <div class="backup-icon" style="background:linear-gradient(135deg, #3b82f6, #1d4ed8);"><i class="fas fa-file-excel"></i></div>
                        <h3>Export to Excel</h3>
                        <p>Download all your data as an organized Excel spreadsheet for reporting.</p>
                        <button class="btn btn-primary" onclick="exportAllDataToExcel()" style="background:#3b82f6;">
                            <i class="fas fa-file-export"></i> Export Excel
                        </button>
                    </div>
                    <div class="backup-card backup-danger">
                        <div class="backup-icon" style="background:linear-gradient(135deg, #ef4444, #b91c1c);"><i class="fas fa-trash-alt"></i></div>
                        <h3>Reset All Data</h3>
                        <p>Permanently delete all data and start fresh. This cannot be undone.</p>
                        <button class="btn btn-danger" onclick="resetAllData()">
                            <i class="fas fa-exclamation-triangle"></i> Reset Everything
                        </button>
                    </div>
                    <div class="backup-card backup-password">
                        <div class="backup-icon" style="background:linear-gradient(135deg, #f59e0b, #d97706);"><i class="fas fa-key"></i></div>
                        <h3>Password Protection</h3>
                        <p id="passwordStatusText">Protect your dashboard with a password. Data stays locked until you enter it.</p>
                        <div class="password-status" id="passwordStatus"></div>
                        <div id="passwordActions">
                            <button class="btn btn-primary" id="btnSetPassword" onclick="openPasswordSetup()" style="background:#f59e0b;">
                                <i class="fas fa-lock"></i> Set Password
                            </button>
                            <button class="btn btn-outline" id="btnChangePassword" onclick="openPasswordChange()" style="display:none;">
                                <i class="fas fa-key"></i> Change Password
                            </button>
                            <button class="btn btn-danger" id="btnRemovePassword" onclick="removePassword()" style="display:none;margin-top:8px;">
                                <i class="fas fa-unlock"></i> Remove Password
                            </button>
                        </div>
                        <div class="password-settings" id="passwordAutoLockSetting" style="display:none;">
                            <label for="autoLockTime" style="color:var(--text-secondary);font-size:13px;margin-top:12px;display:block;">
                                <i class="fas fa-clock"></i> Auto-lock after inactivity:
                            </label>
                            <select id="autoLockTime" onchange="setAutoLockTime(this.value)" style="margin-top:6px;width:100%;padding:8px 12px;background:var(--bg-input);color:var(--text-primary);border:1px solid var(--border);border-radius:8px;font-size:13px;">
                                <option value="0">Never</option>
                                <option value="5">5 minutes</option>
                                <option value="15">15 minutes</option>
                                <option value="30">30 minutes</option>
                                <option value="60">1 hour</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ==================== SETTINGS SECTION ==================== -->
        <section class="content-section" id="section-settings">
            <div class="section-header">
                <div>
                    <h1><i class="fas fa-cog"></i> App Settings</h1>
                    <p class="section-subtitle">Customize your dashboard experience â€” appearance, defaults &amp; preferences</p>
                </div>
            </div>

            <div class="settings-grid">

                <!-- Appearance -->
                <div class="settings-card">
                    <div class="settings-card-header">
                        <div class="settings-card-icon" style="background:linear-gradient(135deg,#8b5cf6,#7c3aed);"><i class="fas fa-palette"></i></div>
                        <div>
                            <h3>Appearance</h3>
                            <p>Theme, accent color &amp; font size</p>
                        </div>
                    </div>
                    <div class="settings-card-body">
                        <div class="settings-row">
                            <div class="settings-label">
                                <i class="fas fa-moon"></i>
                                <div><strong>Theme</strong><span>Switch between dark and light mode</span></div>
                            </div>
                            <div class="settings-control">
                                <label class="settings-toggle">
                                    <input type="checkbox" id="settingThemeToggle" onchange="toggleThemeFromSettings(this.checked)">
                                    <span class="settings-toggle-slider"></span>
                                    <span class="settings-toggle-label" id="settingThemeLabel">Dark</span>
                                </label>
                            </div>
                        </div>
                        <div class="settings-row">
                            <div class="settings-label">
                                <i class="fas fa-tint"></i>
                                <div><strong>Accent Color</strong><span>Primary color for buttons &amp; highlights</span></div>
                            </div>
                            <div class="settings-control">
                                <div class="settings-color-grid" id="settingAccentColors"></div>
                            </div>
                        </div>
                        <div class="settings-row">
                            <div class="settings-label">
                                <i class="fas fa-text-height"></i>
                                <div><strong>Font Size</strong><span>Adjust base font size across the app</span></div>
                            </div>
                            <div class="settings-control">
                                <div class="settings-btn-group">
                                    <button class="settings-size-btn" onclick="setAppFontSize('small')">A<sup>-</sup></button>
                                    <button class="settings-size-btn active" onclick="setAppFontSize('default')">A</button>
                                    <button class="settings-size-btn" onclick="setAppFontSize('large')">A<sup>+</sup></button>
                                </div>
                            </div>
                        </div>
                        <div class="settings-row">
                            <div class="settings-label">
                                <i class="fas fa-expand"></i>
                                <div><strong>Compact Mode</strong><span>Reduce padding and spacing for more content</span></div>
                            </div>
                            <div class="settings-control">
                                <label class="settings-toggle">
                                    <input type="checkbox" id="settingCompactMode" onchange="toggleCompactMode(this.checked)">
                                    <span class="settings-toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Default Values -->
                <div class="settings-card">
                    <div class="settings-card-header">
                        <div class="settings-card-icon" style="background:linear-gradient(135deg,#3b82f6,#1d4ed8);"><i class="fas fa-sliders-h"></i></div>
                        <div>
                            <h3>Default Values</h3>
                            <p>Pre-fill common fields to save time</p>
                        </div>
                    </div>
                    <div class="settings-card-body">
                        <div class="settings-row">
                            <div class="settings-label">
                                <i class="fas fa-map-marker-alt"></i>
                                <div><strong>Default Block</strong><span>Auto-fill in visit &amp; observation forms</span></div>
                            </div>
                            <div class="settings-control settings-control-wide">
                                <input type="text" id="settingDefaultBlock" class="settings-input" placeholder="e.g. Anekal" onchange="saveAppSettings()">
                            </div>
                        </div>
                        <div class="settings-row">
                            <div class="settings-label">
                                <i class="fas fa-layer-group"></i>
                                <div><strong>Default Cluster</strong><span>Auto-fill in visit &amp; observation forms</span></div>
                            </div>
                            <div class="settings-control settings-control-wide">
                                <input type="text" id="settingDefaultCluster" class="settings-input" placeholder="e.g. Sarjapura" onchange="saveAppSettings()">
                            </div>
                        </div>
                        <div class="settings-row">
                            <div class="settings-label">
                                <i class="fas fa-map"></i>
                                <div><strong>Default District</strong><span>Auto-fill in visit forms</span></div>
                            </div>
                            <div class="settings-control settings-control-wide">
                                <input type="text" id="settingDefaultDistrict" class="settings-input" placeholder="e.g. Bengaluru Urban" onchange="saveAppSettings()">
                            </div>
                        </div>
                        <div class="settings-row">
                            <div class="settings-label">
                                <i class="fas fa-building"></i>
                                <div><strong>Default State</strong><span>Auto-fill in forms &amp; reports</span></div>
                            </div>
                            <div class="settings-control settings-control-wide">
                                <input type="text" id="settingDefaultState" class="settings-input" placeholder="e.g. Karnataka" onchange="saveAppSettings()">
                            </div>
                        </div>
                        <div class="settings-row">
                            <div class="settings-label">
                                <i class="fas fa-calendar-alt"></i>
                                <div><strong>Date Format</strong><span>How dates appear throughout the app</span></div>
                            </div>
                            <div class="settings-control">
                                <select id="settingDateFormat" class="settings-select" onchange="saveAppSettings()">
                                    <option value="dd-mmm-yyyy">15-Feb-2026</option>
                                    <option value="dd/mm/yyyy">15/02/2026</option>
                                    <option value="mm/dd/yyyy">02/15/2026</option>
                                    <option value="yyyy-mm-dd">2026-02-15</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Dashboard Preferences -->
                <div class="settings-card">
                    <div class="settings-card-header">
                        <div class="settings-card-icon" style="background:linear-gradient(135deg,#10b981,#059669);"><i class="fas fa-tachometer-alt"></i></div>
                        <div>
                            <h3>Dashboard</h3>
                            <p>Customize your dashboard view</p>
                        </div>
                    </div>
                    <div class="settings-card-body">
                        <div class="settings-row">
                            <div class="settings-label">
                                <i class="fas fa-bell"></i>
                                <div><strong>Smart Alerts</strong><span>Show reminders &amp; insights on dashboard</span></div>
                            </div>
                            <div class="settings-control">
                                <label class="settings-toggle">
                                    <input type="checkbox" id="settingSmartAlerts" checked onchange="saveAppSettings()">
                                    <span class="settings-toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        <div class="settings-row">
                            <div class="settings-label">
                                <i class="fas fa-chart-line"></i>
                                <div><strong>Dashboard Charts</strong><span>Show charts on dashboard overview</span></div>
                            </div>
                            <div class="settings-control">
                                <label class="settings-toggle">
                                    <input type="checkbox" id="settingDashCharts" checked onchange="saveAppSettings()">
                                    <span class="settings-toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        <div class="settings-row">
                            <div class="settings-label">
                                <i class="fas fa-history"></i>
                                <div><strong>Recent Activity</strong><span>Show recent entries on dashboard</span></div>
                            </div>
                            <div class="settings-control">
                                <label class="settings-toggle">
                                    <input type="checkbox" id="settingRecentActivity" checked onchange="saveAppSettings()">
                                    <span class="settings-toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        <div class="settings-row">
                            <div class="settings-label">
                                <i class="fas fa-home"></i>
                                <div><strong>Start Page</strong><span>Which section opens when you launch the app</span></div>
                            </div>
                            <div class="settings-control">
                                <select id="settingStartPage" class="settings-select" onchange="saveAppSettings()">
                                    <option value="dashboard">Dashboard</option>
                                    <option value="visits">School Visits</option>
                                    <option value="observations">Observations</option>
                                    <option value="planner">Weekly Planner</option>
                                    <option value="notes">Quick Notes</option>
                                    <option value="growth">Growth Framework</option>
                                    <option value="worklog">Work Log</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Notifications & Reminders -->
                <div class="settings-card">
                    <div class="settings-card-header">
                        <div class="settings-card-icon" style="background:linear-gradient(135deg,#f59e0b,#d97706);"><i class="fas fa-bell"></i></div>
                        <div>
                            <h3>Notifications</h3>
                            <p>Control reminders &amp; auto-actions</p>
                        </div>
                    </div>
                    <div class="settings-card-body">
                        <div class="settings-row">
                            <div class="settings-label">
                                <i class="fas fa-clipboard-check"></i>
                                <div><strong>Follow-up Reminders</strong><span>Alert when follow-ups are due</span></div>
                            </div>
                            <div class="settings-control">
                                <label class="settings-toggle">
                                    <input type="checkbox" id="settingFollowupReminder" checked onchange="saveAppSettings()">
                                    <span class="settings-toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        <div class="settings-row">
                            <div class="settings-label">
                                <i class="fas fa-calendar-check"></i>
                                <div><strong>Planned Visit Alerts</strong><span>Remind about upcoming planned visits</span></div>
                            </div>
                            <div class="settings-control">
                                <label class="settings-toggle">
                                    <input type="checkbox" id="settingVisitReminder" checked onchange="saveAppSettings()">
                                    <span class="settings-toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        <div class="settings-row">
                            <div class="settings-label">
                                <i class="fas fa-book"></i>
                                <div><strong>Work Log Auto-Add</strong><span>Auto-populate work log from daily entries</span></div>
                            </div>
                            <div class="settings-control">
                                <label class="settings-toggle">
                                    <input type="checkbox" id="settingWorklogAuto" checked onchange="saveAppSettings()">
                                    <span class="settings-toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        <div class="settings-row">
                            <div class="settings-label">
                                <i class="fas fa-save"></i>
                                <div><strong>Auto-Save Indicator</strong><span>Show save confirmation toasts</span></div>
                            </div>
                            <div class="settings-control">
                                <label class="settings-toggle">
                                    <input type="checkbox" id="settingSaveToast" checked onchange="saveAppSettings()">
                                    <span class="settings-toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Data & Storage Info -->
                <div class="settings-card" style="grid-column: 1 / -1;">
                    <div class="settings-card-header">
                        <div class="settings-card-icon" style="background:linear-gradient(135deg,#ef4444,#dc2626);"><i class="fas fa-database"></i></div>
                        <div>
                            <h3>Data &amp; Storage</h3>
                            <p>View data usage and manage storage</p>
                        </div>
                    </div>
                    <div class="settings-card-body">
                        <div class="settings-data-stats" id="settingsDataStats"></div>
                        <div class="settings-actions-row">
                            <button class="btn btn-outline" onclick="exportSettingsJSON()">
                                <i class="fas fa-download"></i> Export Settings
                            </button>
                            <button class="btn btn-outline" onclick="document.getElementById('importSettingsFile').click()">
                                <i class="fas fa-upload"></i> Import Settings
                                <input type="file" id="importSettingsFile" accept=".json" onchange="importSettingsJSON(event)" style="display:none">
                            </button>
                            <button class="btn btn-outline" onclick="resetAppSettings()" style="color:#ef4444;border-color:#ef4444;">
                                <i class="fas fa-undo"></i> Reset to Defaults
                            </button>
                        </div>
                    </div>
                </div>

            </div>
        </section>

        <!-- ==================== FEEDBACK SECTION ==================== -->
        <section class="content-section" id="section-feedback">
            <div class="section-header">
                <div>
                    <h1><i class="fas fa-bug"></i> Bug Report & Feature Request</h1>
                    <p class="section-subtitle">Report bugs or request new features â€” help improve the app</p>
                </div>
                <button class="btn btn-outline" onclick="showUserGuide()" style="white-space:nowrap;"><i class="fas fa-book-open"></i> How to Use</button>
            </div>

            <!-- Submit Form -->
            <div class="fb-form-card">
                <div class="fb-form-header">
                    <div class="fb-type-tabs">
                        <button class="fb-type-tab active" onclick="setFeedbackType('bug')" id="fbTabBug"><i class="fas fa-bug"></i> Bug Report</button>
                        <button class="fb-type-tab" onclick="setFeedbackType('feature')" id="fbTabFeature"><i class="fas fa-lightbulb"></i> Feature Request</button>
                    </div>
                </div>
                <form id="feedbackForm" onsubmit="saveFeedback(event)">
                    <input type="hidden" id="fbType" value="bug">
                    <input type="hidden" id="fbEditId" value="">
                    <div class="form-group">
                        <label><i class="fas fa-heading"></i> Title *</label>
                        <input type="text" id="fbTitle" required placeholder="Brief summary of the issue or request">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label><i class="fas fa-layer-group"></i> Section</label>
                            <select id="fbSection">
                                <option value="">-- Select Section --</option>
                                <option value="Dashboard">Dashboard</option>
                                <option value="School Visits">School Visits</option>
                                <option value="Teacher Training">Teacher Training</option>
                                <option value="Observations">Observations</option>
                                <option value="Visit Plan">Visit Plan</option>
                                <option value="Analytics">Analytics</option>
                                <option value="Planner">Weekly Planner</option>
                                <option value="MARAI">MARAI Tracking</option>
                                <option value="School Work">School Work</option>
                                <option value="Settings">Settings</option>
                                <option value="Data & Backup">Data & Backup</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label><i class="fas fa-exclamation-triangle"></i> Priority</label>
                            <select id="fbPriority">
                                <option value="low">Low</option>
                                <option value="medium" selected>Medium</option>
                                <option value="high">High</option>
                                <option value="critical">Critical</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-align-left"></i> Description *</label>
                        <textarea id="fbDescription" rows="4" required placeholder="Describe the bug step-by-step, or explain the feature you'd like..."></textarea>
                    </div>
                    <div class="fb-form-actions">
                        <button type="button" class="btn btn-ghost" onclick="resetFeedbackForm()">Clear</button>
                        <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Save Report</button>
                    </div>
                </form>
            </div>

            <!-- Saved Reports Table -->
            <div class="card" style="margin-top:20px;">
                <div class="card-header">
                    <h3><i class="fas fa-list"></i> Submitted Reports</h3>
                    <span class="text-muted" id="fbCount"></span>
                </div>
                <div class="card-body" id="fbTableContainer" style="overflow-x:auto;"></div>
            </div>

            <!-- Telegram Bot Config (auto-configured in background) -->
            <div class="tg-config-card" id="tgConfigCard" style="display:none;">
                <div class="tg-config-header" onclick="toggleTelegramConfig()">
                    <div class="tg-config-title">
                        <i class="fab fa-telegram-plane"></i>
                        <span>Telegram Bot Integration</span>
                        <span class="tg-status-dot" id="tgStatusDot" title="Not configured"></span>
                    </div>
                    <i class="fas fa-chevron-down tg-config-chevron" id="tgChevron"></i>
                </div>
                <div class="tg-config-body" id="tgConfigBody" style="display:none;">
                    <p class="tg-config-desc">
                        <i class="fas fa-info-circle"></i>
                        Send bug reports & feature requests directly to your Telegram.
                        Create a bot via <strong>@BotFather</strong> on Telegram, get the token & chat ID.
                    </p>
                    <div class="tg-config-steps">
                        <details>
                            <summary><i class="fas fa-question-circle"></i> How to set up</summary>
                            <ol>
                                <li>Open Telegram, search <strong>@BotFather</strong>, send <code>/newbot</code></li>
                                <li>Follow prompts to name your bot. Copy the <strong>API Token</strong></li>
                                <li>Send any message to your new bot</li>
                                <li>Open: <code>https://api.telegram.org/bot&lt;TOKEN&gt;/getUpdates</code></li>
                                <li>Find <code>"chat":{"id": 123456}</code> â€” that's your <strong>Chat ID</strong></li>
                                <li>Paste both values below and click <strong>Test</strong></li>
                            </ol>
                        </details>
                    </div>
                    <div class="form-row" style="margin-top:12px;">
                        <div class="form-group">
                            <label><i class="fab fa-telegram-plane"></i> Bot Token *</label>
                            <input type="password" id="tgBotToken" placeholder="e.g. 123456:ABC-DEF..." autocomplete="off">
                        </div>
                        <div class="form-group">
                            <label><i class="fas fa-hashtag"></i> Chat ID *</label>
                            <input type="text" id="tgChatId" placeholder="e.g. 987654321" autocomplete="off">
                        </div>
                    </div>
                    <div class="tg-config-actions">
                        <button class="btn btn-outline btn-sm" onclick="testTelegramBot()" id="tgTestBtn"><i class="fab fa-telegram-plane"></i> Test Connection</button>
                        <button class="btn btn-primary btn-sm" onclick="saveTelegramConfig()"><i class="fas fa-save"></i> Save Config</button>
                        <button class="btn btn-ghost btn-sm" onclick="clearTelegramConfig()" style="color:#ef4444;"><i class="fas fa-trash"></i> Clear</button>
                    </div>
                    <div class="tg-test-result" id="tgTestResult" style="display:none;"></div>
                </div>
            </div>
        </section>

    </main>

    <!-- ==================== MODALS ==================== -->

    <!-- Visit Modal -->
    <div class="modal-overlay" id="visitModal">
        <div class="modal">
            <div class="modal-header">
                <h2 id="visitModalTitle"><i class="fas fa-school"></i> New School Visit</h2>
                <button class="modal-close" onclick="closeModal('visitModal')"><i class="fas fa-times"></i></button>
            </div>
            <form id="visitForm" onsubmit="saveVisit(event)">
                <div class="modal-body">
                    <input type="hidden" id="visitId">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="visitSchool">School Name *</label>
                            <input type="text" id="visitSchool" required
                                placeholder="e.g. Government Primary School, Anekal" list="visitSchoolList">
                            <datalist id="visitSchoolList"></datalist>
                        </div>
                        <div class="form-group">
                            <label for="visitBlock">Block</label>
                            <input type="text" id="visitBlock" placeholder="e.g. Anekal" list="visitBlockList">
                            <datalist id="visitBlockList"></datalist>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="visitCluster">Cluster</label>
                            <input type="text" id="visitCluster" placeholder="e.g. Sarjapura" list="visitClusterList">
                            <datalist id="visitClusterList"></datalist>
                        </div>
                        <div class="form-group">
                            <label for="visitDistrict">District</label>
                            <input type="text" id="visitDistrict" placeholder="e.g. Bengaluru Urban">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="visitDate">Visit Date *</label>
                            <input type="date" id="visitDate" required>
                        </div>
                        <div class="form-group">
                            <label for="visitStatus">Status</label>
                            <select id="visitStatus">
                                <option value="planned">Planned</option>
                                <option value="completed">Completed</option>
                                <option value="cancelled">Cancelled</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="visitPurpose">Purpose of Visit</label>
                            <select id="visitPurpose">
                                <option value="Classroom Observation">Classroom Observation</option>
                                <option value="Teacher Support">Teacher Support</option>
                                <option value="Workshop Facilitation">Workshop Facilitation</option>
                                <option value="Material Distribution">Material Distribution</option>
                                <option value="Meeting with HM">Meeting with Head Master</option>
                                <option value="Follow-up">Follow-up Visit</option>
                                <option value="Community Engagement">Community Engagement</option>
                                <option value="TLM Support">TLM Support</option>
                                <option value="Assessment">Assessment</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="visitDuration">Time</label>
                            <select id="visitDuration">
                                <option value="First Half">First Half</option>
                                <option value="Second Half">Second Half</option>
                                <option value="Full Day">Full Day</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="visitPeopleMet">Key People Met</label>
                            <input type="text" id="visitPeopleMet" placeholder="e.g. HM, SDMC, Teachers names">
                        </div>
                        <div class="form-group">
                            <label for="visitRating">Visit Rating</label>
                            <select id="visitRating">
                                <option value="">â€” Rate â€”</option>
                                <option value="5">â­â­â­â­â­ Excellent</option>
                                <option value="4">â­â­â­â­ Good</option>
                                <option value="3">â­â­â­ Average</option>
                                <option value="2">â­â­ Below Average</option>
                                <option value="1">â­ Poor</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="visitNotes">Notes / Key Observations</label>
                        <textarea id="visitNotes" rows="4"
                            placeholder="Describe your observations, discussions, and action points..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="visitFollowUp">Follow-up Actions</label>
                        <textarea id="visitFollowUp" rows="2"
                            placeholder="List any follow-up actions required..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="visitNextDate">Next Visit Date (if planned)</label>
                        <input type="date" id="visitNextDate">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-ghost" onclick="closeModal('visitModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Visit</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Training Modal -->
    <div class="modal-overlay" id="trainingModal">
        <div class="modal">
            <div class="modal-header">
                <h2 id="trainingModalTitle"><i class="fas fa-chalkboard-teacher"></i> New Training</h2>
                <button class="modal-close" onclick="closeModal('trainingModal')"><i class="fas fa-times"></i></button>
            </div>
            <form id="trainingForm" onsubmit="saveTraining(event)">
                <div class="modal-body">
                    <input type="hidden" id="trainingId">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="trainingTitle">Training Title *</label>
                            <input type="text" id="trainingTitle" required
                                placeholder="e.g. Activity-Based Learning Workshop">
                        </div>
                        <div class="form-group">
                            <label for="trainingTopic">Topic / Theme</label>
                            <input type="text" id="trainingTopic" placeholder="e.g. Foundational Numeracy">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="trainingDate">Date *</label>
                            <input type="date" id="trainingDate" required>
                        </div>
                        <div class="form-group">
                            <label for="trainingDuration">Duration (hours)</label>
                            <input type="number" id="trainingDuration" min="0.5" step="0.5" value="3"
                                placeholder="e.g. 3">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="trainingVenue">Venue</label>
                            <input type="text" id="trainingVenue" placeholder="e.g. Block Resource Centre, Anekal">
                        </div>
                        <div class="form-group">
                            <label for="trainingStatus">Status</label>
                            <select id="trainingStatus">
                                <option value="upcoming">Upcoming</option>
                                <option value="completed">Completed</option>
                                <option value="ongoing">Ongoing</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="trainingAttendees">Number of Attendees</label>
                            <input type="number" id="trainingAttendees" min="0" placeholder="e.g. 25">
                        </div>
                        <div class="form-group">
                            <label for="trainingTarget">Target Group</label>
                            <select id="trainingTarget">
                                <option value="Primary Teachers">Primary Teachers</option>
                                <option value="Upper Primary Teachers">Upper Primary Teachers</option>
                                <option value="Head Masters">Head Masters</option>
                                <option value="CRPs">CRPs</option>
                                <option value="Mixed">Mixed Group</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="trainingNotes">Session Notes</label>
                        <textarea id="trainingNotes" rows="3"
                            placeholder="Key points covered, methodology used, materials shared..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="trainingFeedback">Feedback / Observations</label>
                        <textarea id="trainingFeedback" rows="2"
                            placeholder="Teacher feedback, engagement levels, areas for improvement..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-ghost" onclick="closeModal('trainingModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Training</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Observation Modal -->
    <div class="modal-overlay" id="observationModal">
        <div class="modal">
            <div class="modal-header">
                <h2 id="observationModalTitle"><i class="fas fa-clipboard-check"></i> New Observation</h2>
                <button class="modal-close" onclick="closeModal('observationModal')"><i
                        class="fas fa-times"></i></button>
            </div>
            <form id="observationForm" onsubmit="saveObservation(event)">
                <div class="modal-body">
                    <input type="hidden" id="observationId">

                    <!-- Teacher & School Info -->
                    <div class="obs-form-section-label"><i class="fas fa-school"></i> School & Teacher</div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="observationSchool">School Name *</label>
                            <input type="text" id="observationSchool" required list="obsSchoolList"
                                placeholder="e.g. GOVT P.S. AMLIDEEH">
                            <datalist id="obsSchoolList"></datalist>
                        </div>
                        <div class="form-group">
                            <label for="observationTeacher">Teacher Name</label>
                            <input type="text" id="observationTeacher" list="obsTeacherList"
                                placeholder="e.g. KAUSHAL SINGH">
                            <datalist id="obsTeacherList"></datalist>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="observationTeacherPhone">Teacher Phone</label>
                            <input type="tel" id="observationTeacherPhone" placeholder="e.g. 7999899602">
                        </div>
                        <div class="form-group">
                            <label for="observationTeacherStage">Teacher Stage</label>
                            <select id="observationTeacherStage">
                                <option value="">-- Select --</option>
                                <option value="Primary">Primary</option>
                                <option value="ECE">ECE</option>
                                <option value="Upper Primary">Upper Primary</option>
                            </select>
                        </div>
                    </div>

                    <!-- Location Info -->
                    <div class="obs-form-section-label"><i class="fas fa-map-marker-alt"></i> Location</div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="observationCluster">Cluster</label>
                            <input type="text" id="observationCluster" list="obsClusterList"
                                placeholder="e.g. CRC AMLIDIH">
                            <datalist id="obsClusterList"></datalist>
                        </div>
                        <div class="form-group">
                            <label for="observationBlock">Block</label>
                            <input type="text" id="observationBlock" list="obsBlockList"
                                placeholder="e.g. Magarlod">
                            <datalist id="obsBlockList"></datalist>
                        </div>
                    </div>

                    <!-- Observation Details -->
                    <div class="obs-form-section-label"><i class="fas fa-eye"></i> Observation Details</div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="observationDate">Date *</label>
                            <input type="date" id="observationDate" required>
                        </div>
                        <div class="form-group">
                            <label for="observationStatus">Observation</label>
                            <select id="observationStatus">
                                <option value="Yes">Yes - Observed</option>
                                <option value="Not_Observed">Not Observed</option>
                                <option value="No">No</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="observationSubject">Subject</label>
                            <select id="observationSubject">
                                <option value="">-- Select --</option>
                                <option value="Math">Math</option>
                                <option value="Hindi">Hindi</option>
                                <option value="English">English</option>
                                <option value="ECE">ECE</option>
                                <option value="Mathematics">Mathematics</option>
                                <option value="Science">Science</option>
                                <option value="Language">Language</option>
                                <option value="Social Science">Social Science</option>
                                <option value="EVS">EVS</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="observationClass">Class / Grade</label>
                            <select id="observationClass">
                                <option value="">-- Select --</option>
                                <option value="Class 1">Class 1</option>
                                <option value="Class 2">Class 2</option>
                                <option value="Class 3">Class 3</option>
                                <option value="Class 4">Class 4</option>
                                <option value="Class 5">Class 5</option>
                                <option value="Class 6">Class 6</option>
                                <option value="Class 7">Class 7</option>
                                <option value="Class 8">Class 8</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="observationObservedTeaching">Observed While Teaching</label>
                            <select id="observationObservedTeaching">
                                <option value="">-- Select --</option>
                                <option value="True">Yes</option>
                                <option value="False">No</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="observationEngagement">Teacher Engagement Level</label>
                            <select id="observationEngagement">
                                <option value="">-- Select --</option>
                                <option value="More Engaged">More Engaged</option>
                                <option value="Engaged">Engaged</option>
                                <option value="Not Engaged">Not Engaged</option>
                            </select>
                        </div>
                    </div>

                    <!-- Practice Info -->
                    <div class="obs-form-section-label"><i class="fas fa-tasks"></i> Practice Details</div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="observationPracticeType">Practice Type</label>
                            <select id="observationPracticeType">
                                <option value="">-- Select --</option>
                                <option value="Teaching Practice">Teaching Practice</option>
                                <option value="Common Practice">Common Practice</option>
                                <option value="Learning Outcome">Learning Outcome</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="observationPracticeSerial">Practice Serial No.</label>
                            <input type="text" id="observationPracticeSerial" placeholder="e.g. TP-016">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="observationPractice">Practice</label>
                        <textarea id="observationPractice" rows="2"
                            placeholder="Teaching practice description..."></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="observationGroup">Group / Topic</label>
                            <input type="text" id="observationGroup" list="obsGroupList"
                                placeholder="e.g. Pre-number and Counting">
                            <datalist id="obsGroupList"></datalist>
                        </div>
                        <div class="form-group">
                            <label for="observationTopic">Topic Taught</label>
                            <input type="text" id="observationTopic" placeholder="e.g. Fractions, Story Reading">
                        </div>
                    </div>

                    <!-- Ratings (kept for star rating) -->
                    <div class="obs-form-section-label"><i class="fas fa-star"></i> Classroom Ratings</div>
                    <div class="observation-section">
                        <div class="rating-group">
                            <label>Student Engagement</label>
                            <div class="star-rating" id="ratingEngagement" data-field="engagement">
                                <i class="fas fa-star" data-value="1"></i>
                                <i class="fas fa-star" data-value="2"></i>
                                <i class="fas fa-star" data-value="3"></i>
                                <i class="fas fa-star" data-value="4"></i>
                                <i class="fas fa-star" data-value="5"></i>
                            </div>
                        </div>
                        <div class="rating-group">
                            <label>Teaching Methodology</label>
                            <div class="star-rating" id="ratingMethodology" data-field="methodology">
                                <i class="fas fa-star" data-value="1"></i>
                                <i class="fas fa-star" data-value="2"></i>
                                <i class="fas fa-star" data-value="3"></i>
                                <i class="fas fa-star" data-value="4"></i>
                                <i class="fas fa-star" data-value="5"></i>
                            </div>
                        </div>
                        <div class="rating-group">
                            <label>Use of TLM / Materials</label>
                            <div class="star-rating" id="ratingTLM" data-field="tlm">
                                <i class="fas fa-star" data-value="1"></i>
                                <i class="fas fa-star" data-value="2"></i>
                                <i class="fas fa-star" data-value="3"></i>
                                <i class="fas fa-star" data-value="4"></i>
                                <i class="fas fa-star" data-value="5"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Notes -->
                    <div class="obs-form-section-label"><i class="fas fa-pencil-alt"></i> Notes & Feedback</div>
                    <div class="form-group">
                        <label for="observationNotes">Field Notes</label>
                        <textarea id="observationNotes" rows="3"
                            placeholder="Classroom observation notes in detail..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="observationStrengths">Strengths Observed</label>
                        <textarea id="observationStrengths" rows="2"
                            placeholder="What went well in the classroom..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="observationAreas">Areas for Improvement</label>
                        <textarea id="observationAreas" rows="2" placeholder="What could be improved..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="observationSuggestions">Suggestions Given</label>
                        <textarea id="observationSuggestions" rows="2"
                            placeholder="Suggestions provided to the teacher..."></textarea>
                    </div>

                    <!-- Observer & Meta -->
                    <div class="obs-form-section-label"><i class="fas fa-user-tie"></i> Observer Info</div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="observationObserver">Observer Name</label>
                            <input type="text" id="observationObserver" list="obsObserverList"
                                placeholder="e.g. Sitaram Sahu">
                            <datalist id="obsObserverList"></datalist>
                        </div>
                        <div class="form-group">
                            <label for="observationStakeholderStatus">Status</label>
                            <select id="observationStakeholderStatus">
                                <option value="">-- Select --</option>
                                <option value="Active">Active</option>
                                <option value="Inactive">Inactive</option>
                                <option value="Expired">Expired</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-ghost" onclick="closeModal('observationModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Observation</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Resource Modal -->
    <div class="modal-overlay" id="resourceModal">
        <div class="modal modal-sm">
            <div class="modal-header">
                <h2 id="resourceModalTitle"><i class="fas fa-book-open"></i> Add Resource</h2>
                <button class="modal-close" onclick="closeModal('resourceModal')"><i class="fas fa-times"></i></button>
            </div>
            <form id="resourceForm" onsubmit="saveResource(event)">
                <div class="modal-body">
                    <input type="hidden" id="resourceId">
                    <div class="form-group">
                        <label for="resourceTitle">Resource Title *</label>
                        <input type="text" id="resourceTitle" required placeholder="e.g. Fraction Activity Cards">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="resourceType">Type *</label>
                            <select id="resourceType" required>
                                <option value="Worksheet">Worksheet</option>
                                <option value="Lesson Plan">Lesson Plan</option>
                                <option value="Activity">Activity</option>
                                <option value="Reference">Reference Material</option>
                                <option value="TLM">Teaching-Learning Material</option>
                                <option value="Video">Video</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="resourceSubject">Subject</label>
                            <select id="resourceSubject">
                                <option value="Mathematics">Mathematics</option>
                                <option value="Science">Science</option>
                                <option value="Language">Language</option>
                                <option value="Social Science">Social Science</option>
                                <option value="EVS">EVS</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="resourceGrade">Grade / Class</label>
                            <input type="text" id="resourceGrade" placeholder="e.g. Class 3-5">
                        </div>
                        <div class="form-group">
                            <label for="resourceSource">Source</label>
                            <input type="text" id="resourceSource" placeholder="e.g. APF, NCERT, Self-created">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="resourceDescription">Description</label>
                        <textarea id="resourceDescription" rows="3"
                            placeholder="Brief description of this resource, how to use it..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="resourceTags">Tags (comma-separated)</label>
                        <input type="text" id="resourceTags" placeholder="e.g. fractions, hands-on, group activity">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-ghost" onclick="closeModal('resourceModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Resource</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Quick Add Modal -->
    <div class="modal-overlay" id="quickAddModal">
        <div class="modal modal-sm">
            <div class="modal-header">
                <h2><i class="fas fa-plus-circle"></i> Quick Add</h2>
                <button class="modal-close" onclick="closeModal('quickAddModal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body quick-add-body">
                <button class="quick-add-btn" onclick="closeModal('quickAddModal'); openVisitModal()">
                    <i class="fas fa-school"></i>
                    <span>School Visit</span>
                </button>
                <button class="quick-add-btn" onclick="closeModal('quickAddModal'); openTrainingModal()">
                    <i class="fas fa-chalkboard-teacher"></i>
                    <span>Training Session</span>
                </button>
                <button class="quick-add-btn" onclick="closeModal('quickAddModal'); openObservationModal()">
                    <i class="fas fa-clipboard-check"></i>
                    <span>Observation</span>
                </button>
                <button class="quick-add-btn" onclick="closeModal('quickAddModal'); openResourceModal()">
                    <i class="fas fa-book-open"></i>
                    <span>Resource</span>
                </button>
                <button class="quick-add-btn" onclick="closeModal('quickAddModal'); openIdeaModal()">
                    <i class="fas fa-lightbulb"></i>
                    <span>New Idea</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Floating Live Sync Indicator -->
    <div class="sync-floating-indicator" id="syncFloatingIndicator" style="display:none;" onclick="navigateTo('livesync')" title="Live Sync active â€” click to view">
        <div class="sync-float-icon"><i class="fas fa-sync-alt"></i></div>
        <div class="sync-float-body">
            <span class="sync-float-status">Offline</span>
            <span class="sync-float-count-wrap"><span class="sync-float-count">0</span> <i class="fas fa-users"></i></span>
        </div>
        <div class="sync-float-arrow"></div>
    </div>

    <!-- Reflection Modal -->
    <div class="modal-overlay" id="reflectionModal">
        <div class="modal">
            <div class="modal-header">
                <h2 id="reflectionModalTitle"><i class="fas fa-journal-whills"></i> New Reflection</h2>
                <button class="modal-close" onclick="closeModal('reflectionModal')"><i class="fas fa-times"></i></button>
            </div>
            <form id="reflectionForm" onsubmit="saveReflection(event)">
                <div class="modal-body">
                    <input type="hidden" id="reflectionId">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="reflectionMonth">Month *</label>
                            <input type="month" id="reflectionMonth" required>
                        </div>
                        <div class="form-group">
                            <label for="reflectionMood">Overall Feeling</label>
                            <select id="reflectionMood">
                                <option value="great">ðŸ˜Š Great â€” productive month</option>
                                <option value="good">ðŸ™‚ Good â€” steady progress</option>
                                <option value="okay">ðŸ˜ Okay â€” mixed results</option>
                                <option value="challenging">ðŸ˜Ÿ Challenging â€” tough month</option>
                                <option value="difficult">ðŸ˜” Difficult â€” need support</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="reflectionWentWell"><i class="fas fa-check-circle" style="color:#10b981;"></i> What went well this month?</label>
                        <textarea id="reflectionWentWell" rows="3" placeholder="Successful activities, positive teacher/student interactions, breakthroughs..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="reflectionChallenges"><i class="fas fa-exclamation-circle" style="color:#ef4444;"></i> What challenges did you face?</label>
                        <textarea id="reflectionChallenges" rows="3" placeholder="Difficulties in schools, teacher resistance, time management, travel issues..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="reflectionLearnings"><i class="fas fa-brain" style="color:#8b5cf6;"></i> Key learnings & insights</label>
                        <textarea id="reflectionLearnings" rows="3" placeholder="What did you learn about teaching, learning, or your own practice?"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="reflectionNextSteps"><i class="fas fa-arrow-right" style="color:#3b82f6;"></i> Plans for next month</label>
                        <textarea id="reflectionNextSteps" rows="3" placeholder="Focus areas, schools to visit, trainings to conduct, goals..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="reflectionGratitude"><i class="fas fa-heart" style="color:#ec4899;"></i> Gratitude / Highlight</label>
                        <textarea id="reflectionGratitude" rows="2" placeholder="A moment that made your work feel meaningful..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-ghost" onclick="closeModal('reflectionModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Save Reflection</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Contact Modal -->
    <div class="modal-overlay" id="contactModal">
        <div class="modal modal-sm">
            <div class="modal-header">
                <h2 id="contactModalTitle"><i class="fas fa-address-book"></i> Add Contact</h2>
                <button class="modal-close" onclick="closeModal('contactModal')"><i class="fas fa-times"></i></button>
            </div>
            <form id="contactForm" onsubmit="saveContact(event)">
                <div class="modal-body">
                    <input type="hidden" id="contactId">
                    <div class="form-group">
                        <label for="contactName">Name *</label>
                        <input type="text" id="contactName" required placeholder="e.g. Smt. Lakshmi">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="contactRole">Role *</label>
                            <select id="contactRole" required>
                                <option value="Head Master">Head Master</option>
                                <option value="Teacher">Teacher</option>
                                <option value="BEO">BEO</option>
                                <option value="DIET Faculty">DIET Faculty</option>
                                <option value="CRP">CRP</option>
                                <option value="Fellow RP">Fellow RP</option>
                                <option value="Mentor">Mentor</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="contactSchool">School / Organization</label>
                            <input type="text" id="contactSchool" placeholder="e.g. GPS Anekal">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="contactPhone">Phone</label>
                            <input type="tel" id="contactPhone" placeholder="e.g. 9876543210">
                        </div>
                        <div class="form-group">
                            <label for="contactEmail">Email</label>
                            <input type="email" id="contactEmail" placeholder="e.g. name@email.com">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="contactBlock">Block / District</label>
                            <input type="text" id="contactBlock" placeholder="e.g. Anekal Block">
                        </div>
                        <div class="form-group">
                            <label for="contactCluster">Cluster</label>
                            <input type="text" id="contactCluster" placeholder="e.g. Anekal Cluster">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="contactNotes">Notes</label>
                        <textarea id="contactNotes" rows="2" placeholder="Any important details about this contact..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-ghost" onclick="closeModal('contactModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Save Contact</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Bulk Delete Contacts Modal -->
    <div class="modal-overlay" id="bulkDeleteContactsModal">
        <div class="modal" style="max-width:680px;">
            <div class="modal-header">
                <h2><i class="fas fa-trash-alt"></i> Bulk Delete Contacts</h2>
                <button class="modal-close" onclick="closeModal('bulkDeleteContactsModal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <p class="bulk-delete-desc">Check the items you want to filter by. Only checked contacts will be deleted. All filters are combined (AND logic).</p>
                <div class="bulk-delete-filters">
                    <div class="bulk-filter-group">
                        <div class="bulk-filter-header">
                            <label><i class="fas fa-user-tag"></i> Role</label>
                            <div class="bulk-filter-actions">
                                <button type="button" onclick="bulkFilterToggle('bulkDelRole', true)">All</button>
                                <button type="button" onclick="bulkFilterToggle('bulkDelRole', false)">None</button>
                            </div>
                        </div>
                        <div class="bulk-filter-checkboxes" id="bulkDelRole"></div>
                    </div>
                    <div class="bulk-filter-group">
                        <div class="bulk-filter-header">
                            <label><i class="fas fa-map-marker-alt"></i> Block / District</label>
                            <div class="bulk-filter-actions">
                                <button type="button" onclick="bulkFilterToggle('bulkDelBlock', true)">All</button>
                                <button type="button" onclick="bulkFilterToggle('bulkDelBlock', false)">None</button>
                            </div>
                        </div>
                        <div class="bulk-filter-checkboxes" id="bulkDelBlock"></div>
                    </div>
                    <div class="bulk-filter-group">
                        <div class="bulk-filter-header">
                            <label><i class="fas fa-layer-group"></i> Cluster</label>
                            <div class="bulk-filter-actions">
                                <button type="button" onclick="bulkFilterToggle('bulkDelCluster', true)">All</button>
                                <button type="button" onclick="bulkFilterToggle('bulkDelCluster', false)">None</button>
                            </div>
                        </div>
                        <div class="bulk-filter-checkboxes" id="bulkDelCluster"></div>
                    </div>
                    <div class="bulk-filter-group">
                        <div class="bulk-filter-header">
                            <label><i class="fas fa-building"></i> School / Organization</label>
                            <div class="bulk-filter-actions">
                                <button type="button" onclick="bulkFilterToggle('bulkDelSchool', true)">All</button>
                                <button type="button" onclick="bulkFilterToggle('bulkDelSchool', false)">None</button>
                            </div>
                        </div>
                        <div class="bulk-filter-checkboxes" id="bulkDelSchool"></div>
                    </div>
                    <div class="bulk-filter-group">
                        <div class="bulk-filter-header">
                            <label><i class="fas fa-file-import"></i> Source</label>
                            <div class="bulk-filter-actions">
                                <button type="button" onclick="bulkFilterToggle('bulkDelSource', true)">All</button>
                                <button type="button" onclick="bulkFilterToggle('bulkDelSource', false)">None</button>
                            </div>
                        </div>
                        <div class="bulk-filter-checkboxes" id="bulkDelSource"></div>
                    </div>
                    <div class="bulk-filter-group">
                        <div class="bulk-filter-header">
                            <label><i class="fas fa-phone"></i> Phone Status</label>
                        </div>
                        <div class="bulk-filter-checkboxes" id="bulkDelPhone">
                            <label class="bulk-checkbox"><input type="checkbox" value="with" onchange="previewBulkDelete()" checked> <span>With Phone</span></label>
                            <label class="bulk-checkbox"><input type="checkbox" value="without" onchange="previewBulkDelete()" checked> <span>Without Phone</span></label>
                        </div>
                    </div>
                </div>
                <div class="bulk-delete-preview" id="bulkDeletePreview">
                    <div class="bulk-preview-count">
                        <i class="fas fa-users"></i>
                        <span id="bulkDeleteCount">0</span> contacts match
                    </div>
                    <div class="bulk-preview-list" id="bulkDeleteList"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-ghost" onclick="closeModal('bulkDeleteContactsModal')">Cancel</button>
                <button type="button" class="btn btn-danger" id="bulkDeleteConfirmBtn" onclick="executeBulkDeleteContacts()" disabled>
                    <i class="fas fa-trash"></i> Delete <span id="bulkDeleteBtnCount">0</span> Contacts
                </button>
            </div>
        </div>
    </div>

    <!-- Profile Modal -->
    <div class="modal-overlay" id="profileModal">
        <div class="modal modal-sm">
            <div class="modal-header">
                <h2><i class="fas fa-user-circle"></i> My Profile</h2>
                <button class="modal-close" onclick="closeModal('profileModal')"><i class="fas fa-times"></i></button>
            </div>
            <form id="profileForm" onsubmit="saveProfile(event)">
                <div class="modal-body">
                    <div class="profile-avatar-section">
                        <div class="profile-avatar-large" id="profileAvatarLarge"><i class="fas fa-user"></i></div>
                    </div>
                    <div class="form-group">
                        <label for="profileName">Full Name *</label>
                        <input type="text" id="profileName" required placeholder="e.g. Rajesh Kumar S">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="profileDesignation">Designation</label>
                            <select id="profileDesignation">
                                <option value="Resource Person">Resource Person</option>
                                <option value="Block Resource Person">Block Resource Person (BRP)</option>
                                <option value="Cluster Resource Person">Cluster Resource Person (CRP)</option>
                                <option value="District Resource Person">District Resource Person</option>
                                <option value="Academic Coordinator">Academic Coordinator</option>
                                <option value="Fellow">Fellow</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="profileOrg">Organization</label>
                            <input type="text" id="profileOrg" placeholder="Azim Premji Foundation" value="Azim Premji Foundation">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="profileDistrict">District</label>
                            <input type="text" id="profileDistrict" placeholder="e.g. Bengaluru Urban">
                        </div>
                        <div class="form-group">
                            <label for="profileBlock">Block</label>
                            <input type="text" id="profileBlock" placeholder="e.g. Anekal">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="profileState">State</label>
                            <input type="text" id="profileState" placeholder="e.g. Karnataka">
                        </div>
                        <div class="form-group">
                            <label for="profilePhone">Phone</label>
                            <input type="tel" id="profilePhone" placeholder="e.g. 9876543210">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="profileEmail">Email</label>
                        <input type="email" id="profileEmail" placeholder="e.g. name@azimpremjifoundation.org">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-ghost" onclick="closeModal('profileModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Save Profile</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Work Log Entry Modal -->
    <div class="modal-overlay" id="worklogModal">
        <div class="modal modal-sm">
            <div class="modal-header">
                <h2 id="worklogModalTitle"><i class="fas fa-clipboard-list"></i> Add Work Log Entry</h2>
                <button class="modal-close" onclick="closeModal('worklogModal')"><i class="fas fa-times"></i></button>
            </div>
            <form id="worklogForm" onsubmit="saveWorkLogEntry(event)">
                <div class="modal-body">
                    <input type="hidden" id="worklogId">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="worklogDate">Date *</label>
                            <input type="date" id="worklogDate" required>
                        </div>
                        <div class="form-group">
                            <label for="worklogType">Activity Type *</label>
                            <select id="worklogType" required>
                                <option value="School Visit">School Visit</option>
                                <option value="Classroom Observation">Classroom Observation</option>
                                <option value="Training / Workshop">Training / Workshop</option>
                                <option value="Meeting">Meeting (BRC/CRC/Staff)</option>
                                <option value="Desk Work">Desk Work / Planning</option>
                                <option value="Travel">Travel</option>
                                <option value="Data Entry / Reporting">Data Entry / Reporting</option>
                                <option value="Community Engagement">Community Engagement</option>
                                <option value="Material Preparation">Material / TLM Preparation</option>
                                <option value="Leave">Leave</option>
                                <option value="Holiday">Holiday</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="worklogLocation">Location / School</label>
                        <input type="text" id="worklogLocation" placeholder="e.g. GPS Anekal / Block Office">
                    </div>
                    <div class="form-group">
                        <label for="worklogDescription">Description / Key Activities</label>
                        <textarea id="worklogDescription" rows="3" placeholder="Describe what you did today..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="worklogOutcome">Outcome / Remarks</label>
                        <textarea id="worklogOutcome" rows="2" placeholder="Key outcomes or follow-ups..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-ghost" onclick="closeModal('worklogModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Save Entry</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Meeting Modal -->
    <div class="modal-overlay" id="meetingModal">
        <div class="modal" style="max-width:640px;">
            <form id="meetingForm" onsubmit="saveMeeting(event)">
                <div class="modal-header">
                    <h2 id="meetingModalTitle"><i class="fas fa-handshake"></i> New Meeting</h2>
                    <button type="button" class="modal-close" onclick="closeModal('meetingModal')"><i class="fas fa-times"></i></button>
                </div>
                <div class="modal-body" style="max-height:65vh;overflow-y:auto;">
                    <input type="hidden" id="meetingId">
                    <div class="form-group">
                        <label for="meetingTitle">Meeting Title *</label>
                        <input type="text" id="meetingTitle" required placeholder="e.g. Monthly BRC Review Meeting">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="meetingType">Meeting Type *</label>
                            <select id="meetingType" required>
                                <option value="BRC Meeting">BRC Meeting</option>
                                <option value="Cluster Meeting">Cluster Meeting</option>
                                <option value="District Meeting">District Meeting</option>
                                <option value="SDMC Meeting">SDMC Meeting</option>
                                <option value="Parent-Teacher Meeting">Parent-Teacher Meeting</option>
                                <option value="Convergence Meeting">Convergence Meeting</option>
                                <option value="Review Meeting">Review Meeting</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="meetingDate">Date *</label>
                            <input type="date" id="meetingDate" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="meetingLocation">Location / Venue</label>
                            <input type="text" id="meetingLocation" placeholder="e.g. Block Resource Centre">
                        </div>
                        <div class="form-group">
                            <label for="meetingOrganizer">Organizer</label>
                            <input type="text" id="meetingOrganizer" placeholder="e.g. BEO / BRC Coordinator">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="meetingAttendees">Attendees</label>
                        <input type="text" id="meetingAttendees" placeholder="e.g. All RPs, BRC, CRC coordinators (15 members)">
                    </div>
                    <div class="form-group">
                        <label for="meetingAgenda">Agenda</label>
                        <textarea id="meetingAgenda" rows="2" placeholder="Key discussion points..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="meetingDecisions">Decisions Made</label>
                        <textarea id="meetingDecisions" rows="2" placeholder="Key decisions and outcomes..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="meetingKeyTakeaways">Key Takeaways</label>
                        <textarea id="meetingKeyTakeaways" rows="2" placeholder="Important points to remember..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>Action Items <button type="button" class="btn btn-sm btn-outline" onclick="addMeetingActionItem()" style="margin-left:8px;padding:2px 8px;font-size:11px;"><i class="fas fa-plus"></i> Add</button></label>
                        <div id="meetingActionItemsContainer"></div>
                    </div>
                    <div class="form-group">
                        <label for="meetingNextDate">Next Meeting Date</label>
                        <input type="date" id="meetingNextDate">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-ghost" onclick="closeModal('meetingModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Save Meeting</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Idea Modal -->
    <div class="modal-overlay" id="ideaModal">
        <div class="modal">
            <div class="modal-header">
                <h2 id="ideaModalTitle"><i class="fas fa-lightbulb"></i> New Idea</h2>
                <button class="modal-close" onclick="closeModal('ideaModal')"><i class="fas fa-times"></i></button>
            </div>
            <form id="ideaForm" onsubmit="saveIdea(event)">
                <div class="modal-body">
                    <input type="hidden" id="ideaId">
                    <div class="form-group">
                        <label for="ideaTitle">Idea Title *</label>
                        <input type="text" id="ideaTitle" required placeholder="Give your idea a catchy name...">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="ideaCategory">Category</label>
                            <select id="ideaCategory">
                                <option value="Teaching">ðŸŽ“ Teaching</option>
                                <option value="Activity">ðŸŽ¨ Activity</option>
                                <option value="Training">ðŸ“‹ Training</option>
                                <option value="Resource">ðŸ“š Resource</option>
                                <option value="Community">ðŸ¤ Community</option>
                                <option value="Tech">ðŸ’» Tech</option>
                                <option value="Other">ðŸ’¡ Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="ideaStatus">Status</label>
                            <select id="ideaStatus">
                                <option value="spark">âœ¨ Spark</option>
                                <option value="exploring">ðŸ” Exploring</option>
                                <option value="in-progress">ðŸš€ In Progress</option>
                                <option value="done">âœ… Done</option>
                                <option value="archived">ðŸ“¦ Archived</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="ideaPriority">Priority</label>
                            <select id="ideaPriority">
                                <option value="low">ðŸŸ¢ Low</option>
                                <option value="medium" selected>ðŸŸ¡ Medium</option>
                                <option value="high">ðŸ”´ High</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="ideaColor">Color Label</label>
                            <div class="idea-color-picker" id="ideaColorPicker">
                                <span class="color-dot active" data-color="#f59e0b" style="background:#f59e0b" onclick="pickIdeaColor(this)"></span>
                                <span class="color-dot" data-color="#ef4444" style="background:#ef4444" onclick="pickIdeaColor(this)"></span>
                                <span class="color-dot" data-color="#8b5cf6" style="background:#8b5cf6" onclick="pickIdeaColor(this)"></span>
                                <span class="color-dot" data-color="#3b82f6" style="background:#3b82f6" onclick="pickIdeaColor(this)"></span>
                                <span class="color-dot" data-color="#10b981" style="background:#10b981" onclick="pickIdeaColor(this)"></span>
                                <span class="color-dot" data-color="#ec4899" style="background:#ec4899" onclick="pickIdeaColor(this)"></span>
                                <span class="color-dot" data-color="#f97316" style="background:#f97316" onclick="pickIdeaColor(this)"></span>
                                <span class="color-dot" data-color="#06b6d4" style="background:#06b6d4" onclick="pickIdeaColor(this)"></span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="ideaDescription">Description</label>
                        <textarea id="ideaDescription" rows="4" placeholder="Describe your idea in detail â€” what, why, how..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="ideaTags">Tags (comma-separated)</label>
                        <input type="text" id="ideaTags" placeholder="e.g. math, hands-on, innovative, class-3">
                    </div>
                    <div class="form-group">
                        <label for="ideaInspiration">Inspiration / Source</label>
                        <input type="text" id="ideaInspiration" placeholder="Where did this idea come from?">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-ghost" onclick="closeModal('ideaModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Save Idea</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Filtered Import Modal -->
    <div class="modal-overlay" id="filteredImportModal">
        <div class="modal">
            <div class="modal-header">
                <h2><i class="fas fa-filter"></i> Import DMT Data (Filtered)</h2>
                <button class="modal-close" onclick="closeModal('filteredImportModal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div id="filteredImportLoading" class="filtered-import-loading">
                    <i class="fas fa-spinner fa-spin"></i> Reading Excel file...
                </div>
                <div id="filteredImportContent" style="display:none">
                    <p class="unload-modal-desc"><i class="fas fa-file-excel"></i> <strong id="filteredImportFileName"></strong> â€” <span id="filteredImportTotalRows">0</span> total rows found. Select filters to import only matching records.</p>
                    <div class="unload-filters-grid">
                        <div class="form-group">
                            <label for="importFilterState"><i class="fas fa-flag"></i> State</label>
                            <select id="importFilterState" onchange="previewFilteredImport()"><option value="all">All States</option></select>
                        </div>
                        <div class="form-group">
                            <label for="importFilterBlock"><i class="fas fa-map-marker-alt"></i> Block</label>
                            <select id="importFilterBlock" onchange="previewFilteredImport()"><option value="all">All Blocks</option></select>
                        </div>
                        <div class="form-group">
                            <label><i class="fas fa-layer-group"></i> Cluster</label>
                            <div class="cluster-checkbox-wrap" id="importFilterCluster">
                                <div class="cluster-cb-header">
                                    <label class="cluster-select-all"><input type="checkbox" checked onchange="toggleAllClusters('importFilterCluster', this.checked); previewFilteredImport()"> Select All</label>
                                    <span class="cluster-cb-count" id="importClusterCount">0 selected</span>
                                </div>
                                <div class="cluster-cb-search"><input type="text" placeholder="Search clusters..." oninput="filterClusterCheckboxes('importFilterCluster', this.value)"></div>
                                <div class="cluster-cb-list" id="importClusterList"></div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="importFilterObserver"><i class="fas fa-user-tie"></i> Observer</label>
                            <select id="importFilterObserver" onchange="previewFilteredImport()"><option value="all">All Observers</option></select>
                        </div>
                    </div>
                    <div class="unload-preview" id="filteredImportPreview">
                        <div class="unload-preview-empty"><i class="fas fa-info-circle"></i> All records will be imported. Use filters above to narrow down.</div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-ghost" onclick="closeModal('filteredImportModal')">Cancel</button>
                <button type="button" class="btn btn-primary" id="filteredImportConfirmBtn" onclick="executeFilteredImport()" disabled>
                    <i class="fas fa-download"></i> Import <span id="filteredImportCount">0</span> Records
                </button>
            </div>
        </div>
    </div>

    <!-- School Profile Import Modal -->
    <div class="modal-overlay" id="schoolProfileImportModal">
        <div class="modal" style="max-width:720px;">
            <div class="modal-header">
                <h2><i class="fas fa-school"></i> Import School Profiles from Excel</h2>
                <button class="modal-close" onclick="closeModal('schoolProfileImportModal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div id="schoolImportLoading" class="filtered-import-loading">
                    <i class="fas fa-spinner fa-spin"></i> Reading Excel and extracting schools...
                </div>
                <div id="schoolImportContent" style="display:none">
                    <p class="unload-modal-desc"><i class="fas fa-file-excel"></i> <strong id="schoolImportFileName"></strong> â€” <span id="schoolImportTotalSchools">0</span> unique schools found. Use filters to select which schools to import as visits.</p>
                    <div class="unload-filters-grid">
                        <div class="form-group">
                            <label for="schoolImportFilterState"><i class="fas fa-flag"></i> State</label>
                            <select id="schoolImportFilterState" onchange="previewSchoolProfileImport()"><option value="all">All States</option></select>
                        </div>
                        <div class="form-group">
                            <label for="schoolImportFilterBlock"><i class="fas fa-map-marker-alt"></i> Block</label>
                            <select id="schoolImportFilterBlock" onchange="previewSchoolProfileImport()"><option value="all">All Blocks</option></select>
                        </div>
                        <div class="form-group">
                            <label><i class="fas fa-layer-group"></i> Cluster</label>
                            <div class="cluster-checkbox-wrap" id="schoolImportFilterCluster">
                                <div class="cluster-cb-header">
                                    <label class="cluster-select-all"><input type="checkbox" checked onchange="toggleAllClusters('schoolImportFilterCluster', this.checked); previewSchoolProfileImport()"> Select All</label>
                                    <span class="cluster-cb-count" id="schoolImportClusterCount">0 selected</span>
                                </div>
                                <div class="cluster-cb-search"><input type="text" placeholder="Search clusters..." oninput="filterClusterCheckboxes('schoolImportFilterCluster', this.value)"></div>
                                <div class="cluster-cb-list" id="schoolImportClusterList"></div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="schoolImportFilterObserver"><i class="fas fa-user-tie"></i> Observer</label>
                            <select id="schoolImportFilterObserver" onchange="previewSchoolProfileImport()"><option value="all">All Observers</option></select>
                        </div>
                    </div>
                    <div class="unload-preview" id="schoolImportPreview"></div>
                    <div id="schoolImportSchoolList" class="school-import-list"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-ghost" onclick="closeModal('schoolProfileImportModal')">Cancel</button>
                <button type="button" class="btn btn-primary" id="schoolImportConfirmBtn" onclick="executeSchoolProfileImport()" disabled>
                    <i class="fas fa-download"></i> Import <span id="schoolImportCount">0</span> School Profiles
                </button>
            </div>
        </div>
    </div>

    <!-- Bulk Delete Schools Modal -->
    <div class="modal-overlay" id="bulkDeleteSchoolsModal">
        <div class="modal" style="max-width:640px;">
            <div class="modal-header">
                <h2><i class="fas fa-trash-alt" style="color:#ef4444;"></i> Delete School Profiles</h2>
                <button class="modal-close" onclick="closeModal('bulkDeleteSchoolsModal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body" style="max-height:65vh;overflow-y:auto;">
                <!-- Filter panel -->
                <div class="bulk-del-filter-section">
                    <div class="bulk-filter-group">
                        <div class="bulk-filter-header"><span><i class="fas fa-filter"></i> Source</span>
                            <div class="bulk-filter-actions"><button onclick="schoolDelFilterToggle('source','all')">All</button><button onclick="schoolDelFilterToggle('source','none')">None</button></div>
                        </div>
                        <div class="bulk-checkbox-list" id="schoolDelSourceList"></div>
                    </div>
                    <div class="bulk-filter-group">
                        <div class="bulk-filter-header"><span><i class="fas fa-map-marker-alt"></i> Block</span>
                            <div class="bulk-filter-actions"><button onclick="schoolDelFilterToggle('block','all')">All</button><button onclick="schoolDelFilterToggle('block','none')">None</button></div>
                        </div>
                        <div class="bulk-checkbox-list" id="schoolDelBlockList"></div>
                    </div>
                    <div class="bulk-filter-group">
                        <div class="bulk-filter-header"><span><i class="fas fa-layer-group"></i> Cluster</span>
                            <div class="bulk-filter-actions"><button onclick="schoolDelFilterToggle('cluster','all')">All</button><button onclick="schoolDelFilterToggle('cluster','none')">None</button></div>
                        </div>
                        <div class="bulk-checkbox-list" id="schoolDelClusterList"></div>
                    </div>
                    <div class="bulk-filter-group">
                        <div class="bulk-filter-header"><span><i class="fas fa-info-circle"></i> Status</span>
                            <div class="bulk-filter-actions"><button onclick="schoolDelFilterToggle('status','all')">All</button><button onclick="schoolDelFilterToggle('status','none')">None</button></div>
                        </div>
                        <div class="bulk-checkbox-list" id="schoolDelStatusList"></div>
                    </div>
                </div>
                <!-- Preview -->
                <div class="bulk-del-preview" id="schoolDelPreview"></div>
                <!-- School list -->
                <div id="schoolDelList" class="school-del-list"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-ghost" onclick="closeModal('bulkDeleteSchoolsModal')">Cancel</button>
                <button type="button" class="btn btn-danger" id="schoolDelConfirmBtn" onclick="executeBulkDeleteSchools()" disabled>
                    <i class="fas fa-trash-alt"></i> Delete <span id="schoolDelCount">0</span> Schools
                </button>
            </div>
        </div>
    </div>

    <!-- Growth Self-Assessment Modal -->
    <div class="modal-overlay" id="growthAssessModal">
        <div class="modal" style="max-width:780px;">
            <div class="modal-header">
                <h2 id="growthAssessModalTitle"><i class="fas fa-pen-ruler"></i> Self-Assessment</h2>
                <button class="modal-close" onclick="closeModal('growthAssessModal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body" style="max-height:70vh;overflow-y:auto;">
                <div class="growth-assess-mode-toggle" id="growthAssessModeToggle">
                    <button class="growth-mode-btn active" onclick="setGrowthAssessMode('self', event)"><i class="fas fa-user"></i> Self-Assessment</button>
                    <button class="growth-mode-btn" onclick="setGrowthAssessMode('mentor', event)"><i class="fas fa-user-tie"></i> Mentor Assessment</button>
                </div>
                <div id="growthMentorFields" style="display:none;">
                    <div class="form-row" style="margin-bottom:14px;">
                        <div class="form-group">
                            <label><i class="fas fa-user-tie"></i> Mentor/Assessor Name</label>
                            <input type="text" id="growthMentorName" class="settings-input" placeholder="Name of the mentor/assessor">
                        </div>
                        <div class="form-group">
                            <label><i class="fas fa-tag"></i> Assessment Type</label>
                            <select id="growthMentorType" class="settings-select" style="width:100%;">
                                <option value="Quarterly Review">Quarterly Review</option>
                                <option value="Annual Review">Annual Review</option>
                                <option value="Peer Review">Peer Review</option>
                                <option value="Senior Feedback">Senior Feedback</option>
                            </select>
                        </div>
                    </div>
                </div>
                <p style="color:var(--text-muted);font-size:13px;margin-bottom:16px;" id="growthAssessHelpText">
                    <i class="fas fa-info-circle"></i> Honestly assess your current level (1-4) for each dimension. Add notes/evidence to support your self-rating.
                </p>
                <div id="growthAssessForm"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-ghost" onclick="closeModal('growthAssessModal')">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveGrowthAssessment()">
                    <i class="fas fa-save"></i> Save Assessment
                </button>
            </div>
        </div>
    </div>

    <!-- Growth Action Plan Modal -->
    <div class="modal-overlay" id="growthActionModal">
        <div class="modal" style="max-width:600px;">
            <div class="modal-header">
                <h2><i class="fas fa-tasks"></i> Growth Action Plan</h2>
                <button class="modal-close" onclick="closeModal('growthActionModal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="growthActionId">
                <div class="form-group">
                    <label><i class="fas fa-layer-group"></i> Dimension *</label>
                    <select id="growthActionDim" class="settings-select" style="width:100%;" required></select>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-bullseye"></i> Goal / Action Item *</label>
                    <input type="text" id="growthActionTitle" class="settings-input" placeholder="e.g. Independently design a 3-day workshop" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label><i class="fas fa-flag"></i> Target Level</label>
                        <select id="growthActionTargetLevel" class="settings-select" style="width:100%;">
                            <option value="2">Level 2</option>
                            <option value="3">Level 3</option>
                            <option value="4">Level 4</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-calendar"></i> Target Date</label>
                        <input type="date" id="growthActionDate" class="settings-input">
                    </div>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-list"></i> Steps / Sub-tasks</label>
                    <textarea id="growthActionSteps" class="settings-input" style="height:80px;resize:vertical;" placeholder="Break down into small actionable steps..."></textarea>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-hands-helping"></i> Support Needed</label>
                    <input type="text" id="growthActionSupport" class="settings-input" placeholder="e.g. Co-facilitation with senior member, reading material...">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label><i class="fas fa-signal"></i> Priority</label>
                        <select id="growthActionPriority" class="settings-select" style="width:100%;">
                            <option value="high">High</option>
                            <option value="medium" selected>Medium</option>
                            <option value="low">Low</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-info-circle"></i> Status</label>
                        <select id="growthActionStatus" class="settings-select" style="width:100%;">
                            <option value="not-started">Not Started</option>
                            <option value="in-progress">In Progress</option>
                            <option value="completed">Completed</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-ghost" onclick="closeModal('growthActionModal')">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveGrowthAction()">
                    <i class="fas fa-save"></i> Save Action Plan
                </button>
            </div>
        </div>
    </div>

    <!-- Growth Dimension Detail Modal -->
    <div class="modal-overlay" id="growthDimDetailModal">
        <div class="modal" style="max-width:720px;">
            <div class="modal-header">
                <h2 id="growthDimDetailTitle"><i class="fas fa-seedling"></i> Dimension Detail</h2>
                <button class="modal-close" onclick="closeModal('growthDimDetailModal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body" style="max-height:70vh;overflow-y:auto;">
                <div id="growthDimDetailContent"></div>
            </div>
        </div>
    </div>

    <!-- Unload Data Modal -->
    <div class="modal-overlay" id="unloadModal">
        <div class="modal">
            <div class="modal-header">
                <h2><i class="fas fa-filter"></i> Unload Data by Filter</h2>
                <button class="modal-close" onclick="closeModal('unloadModal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <p class="unload-modal-desc">Select one or more filters to remove matching observations. Only imported (DMT) data will be affected â€” your manual entries are safe.</p>
                <div class="unload-filters-grid">
                    <div class="form-group">
                        <label for="unloadState"><i class="fas fa-flag"></i> State</label>
                        <select id="unloadState" onchange="previewUnload()"><option value="all">All States</option></select>
                    </div>
                    <div class="form-group">
                        <label for="unloadBlock"><i class="fas fa-map-marker-alt"></i> Block</label>
                        <select id="unloadBlock" onchange="previewUnload()"><option value="all">All Blocks</option></select>
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-layer-group"></i> Cluster</label>
                        <div class="cluster-checkbox-wrap" id="unloadCluster">
                            <div class="cluster-cb-header">
                                <label class="cluster-select-all"><input type="checkbox" checked onchange="toggleAllClusters('unloadCluster', this.checked); previewUnload()"> Select All</label>
                                <span class="cluster-cb-count" id="unloadClusterCount">0 selected</span>
                            </div>
                            <div class="cluster-cb-search"><input type="text" placeholder="Search clusters..." oninput="filterClusterCheckboxes('unloadCluster', this.value)"></div>
                            <div class="cluster-cb-list" id="unloadClusterList"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="unloadObserver"><i class="fas fa-user-tie"></i> Observer</label>
                        <select id="unloadObserver" onchange="previewUnload()"><option value="all">All Observers</option></select>
                    </div>
                </div>
                <div class="unload-preview" id="unloadPreview">
                    <div class="unload-preview-empty"><i class="fas fa-info-circle"></i> Select filters above to preview which records will be removed</div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-ghost" onclick="closeModal('unloadModal')">Cancel</button>
                <button type="button" class="btn btn-danger" id="unloadConfirmBtn" onclick="executeFilteredUnload()" disabled>
                    <i class="fas fa-eraser"></i> Unload <span id="unloadCount">0</span> Records
                </button>
            </div>
        </div>
    </div>

    <!-- Quick Capture FAB -->
    <button class="quick-capture-fab" id="quickCaptureFab" onclick="openQuickCapture()" title="Quick Observation">
        <i class="fas fa-plus"></i>
    </button>

    <!-- Quick Capture Modal -->
    <div class="modal-overlay" id="quickCaptureModal">
        <div class="modal" style="max-width:440px;">
            <div class="modal-header">
                <h2><i class="fas fa-bolt"></i> Quick Capture</h2>
                <button class="modal-close" onclick="closeModal('quickCaptureModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="quickCaptureForm">
                    <div class="form-group">
                        <label><i class="fas fa-calendar"></i> Date</label>
                        <input type="date" id="qcDate" required>
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-school"></i> School</label>
                        <input type="text" id="qcSchool" list="visitSchoolList" placeholder="School name" required>
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-user"></i> Teacher</label>
                        <input type="text" id="qcTeacher" list="obsTeacherList" placeholder="Teacher name" required>
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-book"></i> Subject</label>
                        <select id="qcSubject">
                            <option value="">Select</option>
                            <option>Language</option><option>Mathematics</option><option>EVS</option>
                            <option>Science</option><option>Social Science</option><option>English</option>
                            <option>Hindi</option><option>Kannada</option><option>Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-fire"></i> Engagement Level</label>
                        <div class="qc-engagement-pills">
                            <button type="button" class="qc-pill low" onclick="setQcEngagement(this,'Not Engaged')"><i class="fas fa-battery-quarter"></i> Not Engaged</button>
                            <button type="button" class="qc-pill mid" onclick="setQcEngagement(this,'Engaged')"><i class="fas fa-battery-half"></i> Engaged</button>
                            <button type="button" class="qc-pill high active" onclick="setQcEngagement(this,'More Engaged')"><i class="fas fa-battery-full"></i> More Engaged</button>
                        </div>
                        <input type="hidden" id="qcEngagement" value="More Engaged">
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-sticky-note"></i> Quick Note</label>
                        <textarea id="qcNote" rows="2" placeholder="One-line observation note..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-ghost" onclick="closeModal('quickCaptureModal')">Cancel</button>
                <button class="btn btn-primary" onclick="saveQuickCapture()"><i class="fas fa-check"></i> Save Observation</button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
    <script src="excel-analytics.js"></script>
</body>

</html>